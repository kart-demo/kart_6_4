"use strict";(Object("undefined"!=typeof self?self:this).webpackChunkkart=Object("undefined"!=typeof self?self:this).webpackChunkkart||[]).push([["src_emulators_common_common_js"],{83498:(e,t,i)=>{i.d(t,{BL:()=>li});var s={};i.r(s),i.d(s,{AgreementsLogic:()=>pe,CloseLogic:()=>h,CommonLogic:()=>G,DumpReportsLogic:()=>ze,EmailReportLogic:()=>g,ExploitPreventionLogic:()=>be,FeedbackLogic:()=>ve,GlobalSubscribeLogic:()=>T,LinksLogic:()=>H,MainPageLogic:()=>K,MainWindowStartLogic:()=>y,ManageAppsLogic:()=>u,ManageMachinesLogic:()=>q,OnboardingLogic:()=>He,PasswordProtectionLogic:()=>fe,ProductLaunchLogic:()=>he,ProductStateStatisticsLogic:()=>Ke,PropertiesLogic:()=>Z,SettingsLogic:()=>d,StatisticsLogic:()=>ye,SupportLogic:()=>$,TestsFacadeLogic:()=>we,ThreatsLogic:()=>z,TrayLogic:()=>S,TypesOfObjectsToDetectLogic:()=>me,UiControllerLogic:()=>M,UpgradeLogic:()=>Re,UserRegistrationLogic:()=>We});var r={};function a(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function n(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,a(e,t,"get"))}function o(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,a(e,t,"set"),i),i}i.r(r),i.d(r,{AgreementsService:()=>Et,ClipboardService:()=>Ze.default,DumpReportsService:()=>Kt,DumpService:()=>qe.default,EnvironmentVarsService:()=>St,ExploitPreventionService:()=>Tt,ExternalSettingsService:()=>Vt,FileService:()=>zt,ForbiddenAppsService:()=>ot,InternalCacheService:()=>ei,IpcService:()=>ii,IpmService:()=>Mt,KartShutdownService:()=>ai,KartUiRegistrationService:()=>Ot,KesMigrationService:()=>oi,KsnService:()=>nt,LinksService:()=>vt,LocalizationService:()=>It,MailService:()=>ut,ModeService:()=>ht,NetworkService:()=>bt,PasswordProtectionService:()=>Pt,PermissionsCheckerService:()=>At,ProductIdentityService:()=>wt,ProductStateService:()=>Ct,ProductStateStatisticsService:()=>Yt,ProductStorageService:()=>mt,ProxyService:()=>rt,ScreenService:()=>at,SettingsVarsService:()=>ti,SharedFoldersProtectionService:()=>ft,ShellService:()=>pt,StatisticsService:()=>Xt,ThreatNotificationsService:()=>dt,ThreatReportService:()=>gt,ThreatService:()=>lt,TimeCounterService:()=>Bt,TraceService:()=>$e.default,TrayService:()=>je.default,TypesOfObjectsToDetectService:()=>Rt,UiRegistrationService:()=>Je.default,UpdateService:()=>Ye.default,UpgradeService:()=>Qt,UserRegistrationService:()=>_t,WindowService:()=>st});var c=i(64296),l=i(11880);const d=class{constructor(e){this.trace=e.get("TraceService"),this.proxyService=e.get("ProxyService"),this.mail=e.get("MailService"),this.mode=e.get("ModeService"),this.trs=e.get("ThreatReportService"),this.sharedFoldersProtectionService=e.get("SharedFoldersProtectionService"),this.productIdentityService=e.get("ProductIdentityService"),this.internalCacheService=e.get("InternalCacheService"),this.ipcService=e.get("IpcService"),this.productStorageService=e.get("ProductStorageService"),this.threatService=e.get("ThreatService")}setProxySettings(e){const t=this.proxyService.getProxySettings();t.mode=e.mode,t.useProxyForLocalAddresses=e.useProxyForLocalAddresses,t.defaultProxy.proxyHost=e.proxyHost,t.defaultProxy.proxyPort=e.proxyPort,t.defaultProxy.proxyAuth.encryptedUserName=this.proxyService.encryptString(e.login),t.defaultProxy.proxyAuth.encryptedPassword=this.proxyService.encryptString(e.password),this.proxyService.setProxySettings(t)}getProxySettings(){const{mode:e,defaultProxy:t,useProxyForLocalAddresses:i}=this.proxyService.getProxySettings(),s=this.proxyService.decryptString(t.proxyAuth.encryptedUserName),r=this.proxyService.decryptString(t.proxyAuth.encryptedPassword);return{mode:e,useProxyForLocalAddresses:i,proxyHost:t.proxyHost,proxyPort:t.proxyPort,login:s,password:r,needAuthentication:Boolean(s)||Boolean(r)}}getMailSettings(){return this.mail.getMailSettings()}setMailSettings(e){return this.mail.setMailSettings(e)}getUserMode(){return this.mode.getUserMode()}setUserMode(e){return this.mode.setUserMode(e)}setThreatsReportSettings(e){return this.trs.setThreatsReportSettings(e)}getThreatsReportSettings(){return this.trs.getThreatsReportSettings()}clearThreatsReportScheduleSettings(){let{sender:e,schedule:t}=this.trs.getThreatsReportSettings(),i={...t,scheduleMode:0};return this.trs.setThreatsReportSettings({sender:e,schedule:i})}checkProxy({spaCallbackChannel:e}){this.spaSubscriber=this.ipcService.createSpaCallback(e),this.proxyService.checkProxy((e=>{this.spaSubscriber(e)}))}setBlockingTime(e){let t=60*e*1e3;return this.sharedFoldersProtectionService.setBlockingTime(t)}getBlockingTime(){let e=this.sharedFoldersProtectionService.getBlockingTime();return e?Math.floor(e/6e4):void 0}setIsSettingChanged(e){this.internalCacheService.setCacheValue("isSettingsChanged",e)}getIsDownloadScanBalloonsEnabled(){return this.threatService.getIsDownloadScanBalloonsEnabled()}setIsDownloadScanBalloonsEnabled(e){this.threatService.setIsDownloadScanBalloonsEnabled(e),this.sendDownloadScanBalloonsStatus(e)}sendDownloadScanBalloonsStatus(e){}},u=class{constructor(e){this.trace=e.get("TraceService"),this.forbiddenAppsService=e.get("ForbiddenAppsService")}unblock(e){return this.forbiddenAppsService.removeForbiddenApp(e)}addToTrusted(e){return this.forbiddenAppsService.addAllowedApp(e)}removeFromTrusted(e){return this.forbiddenAppsService.removeAllowedApp(e)}moveToTrusted(e){let t=this.unblock(e),i=this.addToTrusted(e);return 0===t&&0===i?0:1}getTrustedApps(){return[...this.forbiddenAppsService.getAppList().allowed].reverse()}getBlockedApps(){return[...this.forbiddenAppsService.getAppList().blocked].reverse()}},h=class{constructor(e){this.windowService=e.get("WindowService"),this.trace=e.get("TraceService"),this.statisticsService=e.get("StatisticsService")}closeGui(){this.windowService.getIsGuiToBeRelaunched()?this.windowService.relaunchGui():this.windowService.closeMainWindow(),this.statisticsService.sendStatisticsIfAllowed({source:"mainWindow_byCloseButton",action:"close"})}minimizeGui(){this.windowService.minimizeMainWindow(),this.statisticsService.sendStatisticsIfAllowed({source:"mainWindow_byMinimizeButton",action:"minimize"})}},g=class{constructor(e){this.ms=e.get("MailService"),this.trace=e.get("TraceService"),this.ipcService=e.get("IpcService"),this.threatReportService=e.get("ThreatReportService")}sendReportToAdmin({subject:e,spaCallbackChannel:t}){const i=this.ipcService.createSpaCallback(t);this.ms.sendReport(e,((e,t)=>{i({result:e,smtpResult:t})}))}sendTestEmail({subject:e,spaCallbackChannel:t}){const i=this.ipcService.createSpaCallback(t);this.ms.sendTestEmail(e,((e,t)=>{i({result:e,smtpResult:t})}))}isReportOnDetectEnabled(){return this.threatReportService.getReportOnDetectSetting()}setReportOnDetectEnabled(e){return this.threatReportService.setReportOnDetectSetting(e)}},S=class{constructor(e){}createTray(){}_sendProductStateTrayClickEvents(e){}openGui(){}shutdown(){}showWarningModal(e){}makeTrayExitMenuItemDisabled(e=!1){}};var p=i(40529);const m=41,v=43,w=1345235623;var b=i(7940),f=i(15606),C=i(64030);const R={2:{priority:4,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"failedToSendEmail"},3:{priority:1,autoclose:!0,isCanBeMultiple:!1,isCanBeMuted:!0,name:"reportSuccessSend"},4:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"wrongProxySettings"},5:{priority:1,autoclose:!0,isCanBeMultiple:!1,isCanBeMuted:!1,name:"correctProxySettings"},6:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"unableToSendTextMessage"},7:{priority:1,autoclose:!0,isCanBeMultiple:!1,isCanBeMuted:!0,name:"successSendTextMessage"},10:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!1,name:"malwareWasBlocked"},11:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!0,name:"actionsOfMalwareWereRolledBack"},12:{priority:4,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"eventLoggingIsEnabled"},13:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!1,name:"machineWasBlocked"},14:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!1,name:"blockedLegitimateSoftware"},15:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!0,name:"actionsLegitimateSoftwareRolledBack"},16:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!1,name:"exploitWasBlocked"},18:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"updateInstalledRestartNeeded"},19:{priority:4,autoclose:!0,isCanBeMultiple:!1,isCanBeMuted:!0,name:"rateUs"},20:{priority:2,autoclose:!0,isCanBeMultiple:!1,isCanBeMuted:!0,name:"newMessageFromKaspersky"},21:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"regionalDataProcessing"},22:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"acceptAgreementsEnablingProtection"},23:{priority:4,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"proxyRequest"},24:{priority:1,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"passwordRequest"},25:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"malwareWasFound"},26:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"malwareWasNotFound"},27:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"sendDumpReport"},28:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"malwareScanReportFailed"},29:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"undocDisabling"},30:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"activityReport"},31:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"newVersionAvailable"},32:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"oldVersionUninstallFailed"},33:{priority:2,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"sendEtlReport"},34:{priority:1,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"noExitWhileNewInstallation"},35:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"tfuManualUpgradeRequest"},36:{priority:1,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"failedToGetUserRegistrationFormManually"},37:{priority:2,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!0,name:"downloadedFileIsSafe"},39:{priority:1,autoclose:!1,isCanBeMultiple:!0,isCanBeMuted:!0,name:"downloadedFileIsDangerous"},40:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"acceptAgreements"},[m]:{priority:4,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"aboutFreeLesson"},42:{priority:3,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!0,name:"boostProtection"},[v]:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"startMigration"},44:{priority:0,autoclose:!1,isCanBeMultiple:!1,isCanBeMuted:!1,name:"eolProduct"}},M=class{constructor(e){this.electron=e.get("electron"),this.windowService=e.get("WindowService"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this.shutdownService=e.get("KartShutdownService"),this.trace=e.get("TraceService"),this.productStorage=e.get("ProductStorageService"),this.dumpService=e.get("DumpService"),this.modeService=e.get("ModeService"),this.trayService=e.get("TrayService"),this.productIdentityService=e.get("ProductIdentityService"),this.statisticsService=e.get("StatisticsService"),this.ipcService=e.get("IpcService")}setShutdownCallback(){this.uiRegistrationService.setShutdownCallback((()=>{this.trayService.destroy(),this.shutdownService.shutdownUI()}))}setRelaunchCallback(){this.uiRegistrationService.setRelaunchCallback((e=>{const t=this.windowService.getMainWindow(),{isForceRelaunch:i}=(0,p.safeParseJson)(e);!t||i?this.windowService.relaunchGui():this.windowService.setIsGuiToBeRelaunched(!0)}))}setRefreshTracesSettingsCallback(){this.uiRegistrationService.setRefreshTraceSettings((()=>{let{enabled:e}=this.trace.getTraceState();this.trace.switchTraces(e)}))}setDumpCallback(){this.uiRegistrationService.setCreateDump((()=>(this.dumpService.writeDump(),0)))}setBalloonCallback(){this.uiRegistrationService.setResolveBalloon(((e,t)=>{"string"==typeof t&&t.length&&JSON.parse(t).smtpCode}))}setProxyRequestCallbacks(){this.uiRegistrationService.setShowProxyBalloonCallback((()=>{const e=this.windowService.getModalWindowById(23);if(null!=e&&e.id)return C.MR;this.electron.ipcMain.once("proxy-request-resolve",((e,t)=>{var i;const s=(0,p.safeJsonStringify)({username:t.username,password:t.password,needSave:!0});this.uiRegistrationService.sendResponse(w,C.MR,s),null===(i=this._spaProxyCredentialsCallback)||void 0===i||i.call(this)})),this.electron.ipcMain.once("proxy-request-cancel",((e,t)=>{this.uiRegistrationService.sendResponse(w,C.VY,b.ZD),this.statisticsService.sendStatisticsIfAllowed({source:`balloon_${R[23].name}CancelRequest`,action:"close"})})),this.windowService.createModalWindow({id:23,options:{alwaysOnTop:!0}})})),this.uiRegistrationService.setHideProxyBalloonCallback((()=>{const e=this.windowService.getModalWindowById(23);null==e||e.webContents.send(f.ui)}))}setSpaProxyCredentialsCallback({spaCallbackChannel:e}){this._spaProxyCredentialsCallback=this.ipcService.createSpaCallback(e)}setShowPanelCallback(){this.uiRegistrationService.setShowPanel((e=>{if(this.windowService.showMainWindow(),this.windowService.focusMainWindow(),e===b.OL){const e=this.windowService.getMainWindow();e.once("show",(()=>{null==e||e.webContents.send("spa:navigation_event","details")})),null==e||e.webContents.send("spa:navigation_event","details")}}))}setShowWindowCallback(){this.uiRegistrationService.setShowWindow((e=>{switch(e){case 0:return 0;case 1:this.windowService.minimizeMainWindow();break;case 2:default:this.windowService.showMainWindow(),this.windowService.focusMainWindow();break;case 3:this.windowService.hideMainWindow()}return 0}))}setShowProtectionStateCallback({spaCallbackChannel:e}){const t=this.ipcService.createSpaCallback(e);this.uiRegistrationService.setShowProtectionState((e=>{t(e)}))}setRefreshIconCache(){this.uiRegistrationService.setRefreshIconCache()}switchUiCallbacks(e){this.setShutdownCallback(),this.setRefreshTracesSettingsCallback(),this.setDumpCallback(),this.setBalloonCallback(),this.setShowPanelCallback(),this.setShowWindowCallback(),this.setProxyRequestCallbacks(),this.setRefreshIconCache(),this.setRelaunchCallback(),this.uiRegistrationService.registerUi(e)}},y=class{constructor(e){this.electron=e.get("electron"),this.windowService=e.get("WindowService"),this.trace=e.get("TraceService")}createMainWindow(){this.windowService.createMainWindow()}showMainWindow(){this.windowService.showMainWindowAfterCreate()}getMainWindow(){return this.windowService.getMainWindow()}};var I=i(54363);const T=class{constructor(e){this.win=e.get("WindowService"),this.screen=e.get("ScreenService"),this.productStorage=e.get("ProductStorageService"),this.statisticsService=e.get("StatisticsService"),this.electron=e.get("electron"),this.networkService=e.get("NetworkService"),this.trace=e.get("TraceService"),this.shutdownService=e.get("KartShutdownService"),this.threatsService=e.get("ThreatService"),this.agreementsService=e.get("AgreementsService"),this.ipcService=e.get("IpcService"),this._previousScreenMode=I.w.WINDOW}subscribeToTracesState(){this._showBalloonIfTracesOn(),setInterval((()=>{this._showBalloonIfTracesOn()}),864e5)}_showBalloonIfTracesOn(){this.trace.getTraceState()}setDisableTracesFromBalloonSpaCallback(e){this.disableTracesFromBalloonSpaCallback=e}_subscribeToDisableTraceFromBalloon(){this.electron.ipcMain.on("disable-traces",((e,t)=>{this.trace.switchTraces(!1),this.statisticsService.sendStatisticsIfAllowed({source:"balloon_disableTracesFromBalloon",action:"click"}),setTimeout((()=>{"function"==typeof this.disableTracesFromBalloonSpaCallback&&this.disableTracesFromBalloonSpaCallback()}),200)}))}_subscribeToNavigateEventFromBalloon(){const e=({modalId:e,page:t})=>{if(e)40===e&&this.showAcceptAgreementsModal();else if(t){this.win.getMainWindow()?this.win.showMainWindowAfterCreate():this.win.createMainWindow();const e=this.win.getMainWindow();e.isVisible()?null==e||e.webContents.send("spa:navigation_event",t):e.once("show",(()=>null==e?void 0:e.webContents.send("spa:navigation_event",t))),this.statisticsService.sendStatisticsIfAllowed({source:`page_${t}FromBalloon`,action:"open"})}};this.electron.ipcMain.on(f.Bz,((t,i)=>e(i)))}showAcceptAgreementsModal(){if(this.win.getModalWindowById(40));else{const e=this.agreementsService.getActualNotAcceptedAgreementsInfo(),t=this.agreementsService.getNotAcceptedAgreementsText(),i=(e,t)=>{var i;this.agreementsService.registerAcceptanceFacts(t),this.agreementsService.clearAgreementBalloonTimeout(),null===(i=this._spaOnAgreementsAcceptedSubscriber)||void 0===i||i.call(this,!0)},s=()=>{var e;null===(e=this._spaOnAgreementsAcceptedSubscriber)||void 0===e||e.call(this,!1),this.electron.ipcMain.removeListener(f.ee,i)};this.agreementsService.scheduleAcceptAgreementsNotification(),this.electron.ipcMain.once(f.ee,i),this.electron.ipcMain.once(f.XG,s),this.win.createModalWindow({id:40,data:{agreementsAcceptanceFacts:e,notAcceptedAgreementsText:t},width:624})}}_subscribeToRebootOsFromBalloon(){this.electron.ipcMain.on("reboot-os",((e,t)=>{setTimeout((()=>{this.shutdownService.rebootOs()}),200),this.statisticsService.sendStatisticsIfAllowed({source:"balloon_rebootOsFromBalloon",action:"click"})}))}subscribeOnProductIconClick(){this.win.subscribeOnProductIconClick()}subscribeOnScreenModeChange(){const e={onFullScreenChange:e=>{e===I.w.WINDOW&&this._previousScreenMode!==I.w.WINDOW&&(this._previousScreenMode=e)}};this.screen.subscribeOnScreenModeChange(e)}_subscribeOnDsBalloonsStatusChangedFromBalloon(){this.electron.ipcMain.on(f.LX,((e,t)=>{this.threatsService.setIsDownloadScanBalloonsEnabled(t.isBalloonEnabled);const i=this.win.getMainWindow();(null==i?void 0:i.isVisible())&&(null==i||i.webContents.send(l.K7,t.isBalloonEnabled))}))}subscribeOnAgreementsAcceptance({spaCallbackChannel:e}){this._spaOnAgreementsAcceptedSubscriber=this.ipcService.createSpaCallback(e)}};var P=i(91525),E=i(29411),A=i(58577),k=i(52394),D=i(79158);const F="malware_scan";var L=i(62760),B=i(59890);function _(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function N(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var x=new WeakSet,O=new WeakSet;function U(e){if(this.permissionsCheckerService.checkFeatureAllowance(D.SZ))return e;if(this.permissionsCheckerService.checkFeatureAllowance(D.Xz)){const{malwareListLength:t,totalFilesScanned:i,sessionGuid:s,sequenceNumber:r,resultCode:a}=e;return{malwareListLength:t,totalFilesScanned:i,sessionGuid:s,sequenceNumber:r,resultCode:a}}if(this.permissionsCheckerService.checkFeatureAllowance(D.S0)){const{malwareListLength:t,totalFilesScanned:i,sessionGuid:s,sequenceNumber:r}=e;return{malwareListLength:t,totalFilesScanned:i,sessionGuid:s,sequenceNumber:r}}if(this.permissionsCheckerService.checkFeatureAllowance(D.RW)){const{malwareListLength:t,totalFilesScanned:i}=e;return{malwareListLength:t,totalFilesScanned:i}}return{}}function W(e){const{sessionGuid:t,...i}=N(this,x,U).call(this,{...e.value,sessionGuid:e.sessionGuid});this.statisticsService.sendStatisticsIfAllowed({source:e.source,action:e.action,value:i,sessionGuid:t})}const z=class{constructor(e){_(this,O),_(this,x),this.threatsService=e.get("ThreatService"),this.threatNotificationsService=e.get("ThreatNotificationsService"),this.trace=e.get("TraceService"),this.serviceRegistry=e,this.localizationService=e.get("LocalizationService"),this.windowService=e.get("WindowService"),this.statisticsService=e.get("StatisticsService"),this.productStorageService=e.get("ProductStorageService"),this.timeCounterService=e.get("TimeCounterService"),this.productStorage=e.get("ProductStorageService"),this.electron=e.get("electron"),this.ipcService=e.get("IpcService"),this.forbiddenAppsService=e.get("ForbiddenAppsService"),this.permissionsCheckerService=e.get("PermissionsCheckerService"),this.productIdentityService=e.get("ProductIdentityService"),this.agreementsService=e.get("AgreementsService"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this.onThreatEventSpaCallback=()=>{}}getThreats({startIndex:e,stopIndex:t}){return this.threatsService.getThreats(e,t)}clearReport(){this.threatsService.clearReport()}subscribeOnThreats(){this.threatNotificationsService.subscribe((e=>{if(e.eventType===k.lB)this.showExploitPreventionBalloon({name:e.threatName,path:e.threatPath});else{if(e.eventType===k.Bh)return this.showThreatOrRollbackBalloon({swAction:e.action,name:e.threatName,path:e.threatPath}),C.MR;{const{dictionaries:{remoteMachine:t}}=this.localizationService.getLocalizationResources();switch(e.threatType){case E.EK:case E.ZP:case E.sy:this.showAdwareRiskwarePornwareOrRollbackBalloon({swAction:e.action,name:e.threatName,path:e.threatPath});break;default:e.isRemote?this.showRemoteThreatOrRollbackBalloon({swAction:e.action,name:e.threatName,address:e.threatPath||t}):this.showThreatOrRollbackBalloon({swAction:e.action,name:e.threatName,path:"system"===e.threatPath.toLowerCase()?t:e.threatPath})}}}"function"==typeof this.onThreatEventSpaCallback&&this.onThreatEventSpaCallback(e)}))}setOnThreatEventSpaCallback({spaCallbackChannel:e}){const t=this.ipcService.createSpaCallback(e);this.onThreatEventSpaCallback=t}showThreatOrRollbackBalloon(e){}showRemoteThreatOrRollbackBalloon(e){}showAdwareRiskwarePornwareOrRollbackBalloon(e){}showExploitPreventionBalloon(e){}getThreatsReportSize(){return this.threatsService.getThreatsReportSize()}getMalwareScanInfo(){return this.threatsService.getLastMalwareScanInfo()}startMalwareScan(){this.threatsService.startMalwareScan()}stopMalwareScan(){this.threatsService.stopMalwareScan()}_onMalwareScanStopHandler(e){var t,i;this.subscribeOnRemindLaterOnMlwsBalloon();const s=this.getMalwareScanInfo(),r={source:"malwareScanResult_blMalwareScanStopHandler",action:"scanCompleted",value:{malwareListLength:(null==s||null===(t=s.malwareList)||void 0===t?void 0:t.length)||b.Ds,totalFilesScanned:(null==s||null===(i=s.statistic)||void 0===i?void 0:i.totalFiles)||b.Ds,resultCode:e,internetConnection:s.internetConnection,trustedKL:s.trustedKL,trustedMS:s.trustedMS,cashCount:s.ksnCachedCount,startTime:s.scanStartTime,scanDuration:s.scanDuration}};N(this,O,W).call(this,r)}setSpaMlwsCallbacks({onStartCallbackChannel:e,onStopCallbackChannel:t,onProgressCallbackChannel:i,onStatusChangedCallbackChannel:s}){this._spaOnStartMlwsSubscriber=this.ipcService.createSpaCallback(e),this._spaOnStopMlwsSubscriber=this.ipcService.createSpaCallback(t),this._spaOnProgressMlwsSubscriber=this.ipcService.createSpaCallback(i),this._spaOnStatusChangedMlwsSubscriber=this.ipcService.createSpaCallback(s)}subscribeOnMalwareScan(){const e={onStart:()=>{var e;const t=this.statisticsService.getGuidRelatedToFeature(F),i=this.productStorageService.get("malwareScanSequenceNumber")||b.Ds;this.statisticsService.sendStatisticsIfAllowed({source:"malwareScan",action:"start",value:{sequenceNumber:i+b.OL},sessionGuid:t}),this.productStorageService.set("malwareScanSequenceNumber",i+b.OL),null===(e=this._spaOnStartMlwsSubscriber)||void 0===e||e.call(this)},onStop:e=>{var t;null===(t=this._spaOnStopMlwsSubscriber)||void 0===t||t.call(this),this._onMalwareScanStopHandler(e);const i=this.statisticsService.getGuidRelatedToFeature(F),s=this.productStorageService.get("malwareScanSequenceNumber");N(this,O,W).call(this,{source:"malwareScan",action:"stop",value:{sequenceNumber:s},sessionGuid:i}),this.statisticsService.resetGuidRelatedToFeature(F)},onProgressChanged:e=>{var t;return null===(t=this._spaOnProgressMlwsSubscriber)||void 0===t?void 0:t.call(this,e)},onScanStateChanged:e=>{var t;null===(t=this._spaOnStatusChangedMlwsSubscriber)||void 0===t||t.call(this,e)}};this.threatsService.subscribeOnMalwareScan(e)}getActivityReportForSevenDays(){return this.threatsService.getActivityReport(7)}getActivityReportForThirtyDays(){return this.threatsService.getActivityReport(30)}_getTargetFridayDate(){const e=24*b.Yn,t=(new Date).getDay(),i=(5-t<b.Ds?7-(5-t):5-t)*e;return new Date(Date.now()+i).setHours(12,0,0)}_createActivityReportIntervalSchedule(){this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:168,listener:this.showActivityReportBalloon.bind(this),listenerLabel:"showActivityReportBalloon"})}_triggerActivityReportTimeout(){this._createActivityReportIntervalSchedule(),this.showActivityReportBalloon()}showActivityReportBalloon(){}scheduleActivityReport(){var e;const t="showActivityReportBalloon",i=this.timeCounterService.getTriggeredTimeouts();if(null==i||null===(e=i[t])||void 0===e?void 0:e.length)this._createActivityReportIntervalSchedule();else{const e=Date.now(),i=this._getTargetFridayDate(),s=Math.abs((e-i)/b.Yn);this.timeCounterService.getHourEvents("timeout",t).forEach((e=>{this.timeCounterService.deleteTimeEventListener({typeOfEvent:"timeout",hoursEvent:e,listenerLabel:t})})),this.timeCounterService.addTimeEventListener({typeOfEvent:"timeout",hoursEvent:s,listener:this._triggerActivityReportTimeout.bind(this),listenerLabel:t})}}showBalloonWithLaterButton(e){}subscribeOnRemindLaterOnMlwsBalloon(){this.electron.ipcMain.once(l.lL,((e,{rendererId:t})=>{this.timeCounterService.addTimeEventListener({typeOfEvent:"timeout",hoursEvent:2,listener:this.showBalloonWithLaterButton.bind(this,t),listenerLabel:`remindLaterFrom${t}Balloon`})}))}_filterInfoForStatistic(e){const t=this.agreementsService.getAcceptanceFactsWithoutRdp(),i=this.productIdentityService.getEdition()===A.L,s=t.filter((e=>e.version.includes("supplemental_")&&e.accepted)).map((e=>parseInt(e.version.split("supplemental_")[1],10))),r=e=>s.find((t=>t>=(i&&e.home||e.business)));return r({home:5,business:8})?e:r({home:3,business:6})?{dateTime:e.dateTime,resolved:e.resolved,exist:e.exist}:i||r({home:1,business:4})?{resolved:e.resolved,exist:e.exist}:{}}sendDownloadScanStatistics(){const e=this.threatsService.getDownloadsScanInfo(),t=this.isDownloadsScanEnabled()?b.Ds:b.OL,i={...e,result:e.result!==C.MR?e.result:t},s=this.permissionsCheckerService.checkFeatureAllowance(D.tU);this.statisticsService.sendStatisticsIfAllowed({source:"downloadScan",action:"startCheck",value:{...this._filterInfoForStatistic(i),userId:s?i.userId:b.ZD}})}isDownloadsScanEnabled(){return this.threatsService.isDownloadsScanEnabled()}subscribeOnDownloadsScan(){const e=this.isDownloadsScanEnabled();this.sendDownloadScanStatistics(),this.threatNotificationsService.subscribeOnDownloadsScan(((e,t)=>{if(e===C.MR){const e=this.threatsService.getIsDownloadScanBalloonsEnabled();({...t,name:t.fullName.split("\\").pop(),path:t.fullName,type:"Application",status:(0,B.$c)(t.status),isBalloonsEnabled:e}).status===P.P6&&this.blockApplication(t.fullName)}})),e&&this.threatsService.startDownloadsScan()}setOnAppBlockedEventSpaCallback({spaCallbackChannel:e}){this._onAppBlockedEventSpaCallback=this.ipcService.createSpaCallback(e)}blockApplication(e){const t=this.forbiddenAppsService.addForbiddenApp(e);if(t===C.MR){var i;const s={action:L.SL,isRemote:!1,eventType:k.Bh,threatName:"Malware",threatPath:e,threatType:E.W5,objectName:b.ZD,objectPath:b.ZD,objectType:-b.OL,time:Date.now(),result:t};this.threatsService.addEventWithoutNotification(s),null===(i=this._onAppBlockedEventSpaCallback)||void 0===i||i.call(this)}return t}setSpaFeatureFlagChangeSubscriber({spaCallbackChannel:e}){this._spaCallbackFeatureFlagChange=this.ipcService.createSpaCallback(e)}subscribeOnDownloadScanFeatureFlagChange(){this.uiRegistrationService.addFeatureFlagUpdatedCallback((()=>{"function"==typeof this._spaCallbackFeatureFlagChange&&this._spaCallbackFeatureFlagChange(),this.threatsService.changeDownloadsScanState()}))}},G=class{constructor(e){this.trace=e.get("TraceService"),this.clipboardService=e.get("ClipboardService"),this.dumpService=e.get("DumpService"),this.windowService=e.get("WindowService"),this.fileService=e.get("FileService"),this.shutdownService=e.get("KartShutdownService"),this.uiRegistrationService=e.get("KartUiRegistrationService")}copyToClipboard(e){this.clipboardService.copyToClipboard(e)}traceSPAInfo(e){}traceInfo(e){}traceError(e){}createDump(e){void 0===e?this.dumpService.writeDump():this.dumpService.writeDumpWithInfo(String(e))}getFilePath(){const e=this.windowService.getMainWindow();return this.fileService.openFilePath(e)}prepareSafeExit(){this.uiRegistrationService.unregisterUi(),this.shutdownService.join()}};var V=i(66125);const K=class{constructor(e){this.trace=e.get("TraceService"),this.productState=e.get("ProductStateService"),this.productStorage=e.get("ProductStorageService"),this.ksn=e.get("KsnService"),this.ipcService=e.get("IpcService"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this.environmentVarsService=e.get("EnvironmentVarsService"),this.timeCounterService=e.get("TimeCounterService")}getKsnInfo({spaCallbackChannel:e}){const t=this.ipcService.createSpaCallback(e);this.ksn.getKsnInfo(((e,i)=>{t(i)}))}getProductState({spaCallbackChannel:e}){const t=this.ipcService.createSpaCallback(e);this.productState.getState((e=>{t(e===b.OL)}))}isProductEol(){return"1"===this.environmentVarsService.expandEnvironmentVar(V.le)}setSpaEolStatusSubscriber({spaCallbackChannel:e}){this._spaCallbackEolStatusChange=this.ipcService.createSpaCallback(e)}subscribeBlOnEolStatusChange(){this.uiRegistrationService.setEolStatusCallback((()=>{"function"==typeof this._spaCallbackEolStatusChange&&this._spaCallbackEolStatusChange()}))}},H=class{constructor(e){this.shell=e.get("ShellService"),this.trace=e.get("TraceService"),this.linksService=e.get("LinksService"),this.electron=e.get("electron")}shellOpenExternal(e){this.shell.openExternal(e)}openInterceptorLink(e){let t=this.linksService.getInterceptorLink(e);return this.shellOpenExternal(t),t}openHelpLink(e){const t=`${this.linksService.getInterceptorLink("online_help")}&helpid=${e}`;return this.shell.openExternal(t),t}openExternalLink(e){this.shell.openExternal(e)}openExtendedFeedbackLink(){let e=this.linksService.getExtendedFeedbackLink();return this.shell.openExternal(e),e}getRawGetPremiumLink(e){return this.linksService.getGetPremiumLink(e)}openRedirectorLink(e){const t=this.getRawGetPremiumLink(e);this.shellOpenExternal(t)}},$=class{constructor(e){this.trace=e.get("TraceService"),this.electron=e.get("electron")}switchTraces(e){this.trace.switchTraces(e)}setTraceLevel(e){this.trace.setTraceLevel(e)}getTracesState(){return this.trace.getTraceState()}},Z=class{constructor(e){this.trace=e.get("TraceService"),this.environmentVarsService=e.get("EnvironmentVarsService"),this.updateService=e.get("UpdateService"),this.productIdentityService=e.get("ProductIdentityService"),this.localizationService=e.get("LocalizationService"),this.windowService=e.get("WindowService")}getProductVersion(){return this.environmentVarsService.expandEnvironmentVar(V.Fe)}getProductHotfix(){return this.updateService.getProductHotfix()}isDebug(){return this.productIdentityService.isDebugMode()}isSpectronEnabled(){return this.productIdentityService.getSpectronEnabled()}getMachineID(){return this.productIdentityService.getMachineId()}getProductInstallationID(){return this.productIdentityService.getInstallationId()}getEdition(){return this.productIdentityService.getEdition()}getLocalization(){return this.localizationService.getLocalization()}getLocalizationResources(){return this.localizationService.getLocalizationResources()}getRebrandingCode(){return this.environmentVarsService.expandEnvironmentVar(V.k3)}getAppId(){return this.productIdentityService.getAppId()}getPpcsId(){return this.productIdentityService.getPpcsId()}},q=class{constructor(e){this.trace=e.get("TraceService"),this.sharedFoldersProtectionService=e.get("SharedFoldersProtectionService")}addToTrusted(e){return this.sharedFoldersProtectionService.addAllowedAddress(e)}removeFromTrusted(e){return this.sharedFoldersProtectionService.removeAllowedAddress(e)}moveToTrusted(e){return 0===this.addToTrusted(e)?0:1}getTrustedAddresses(){return this.sharedFoldersProtectionService.getAllowedAddressesList()}getForbiddenAddress(){return this.sharedFoldersProtectionService.getBlockedAddressesList()}};var j=i(524);const J="productAliveTimestamp",Y="onboardingInfo",X="previousProductStateStatisticsEvents",Q="marketoFormSnapshot",ee="isPSRegistrationEventWasResent",te="productVersion",ie="isDownloadScanBalloonsEnabled",se="isMarketoWaitingSubmission",re="marketoFormUserInput",ae="registrationSchedulerIntervalInHour",ne="productStateRegistrationDraftEvents",oe="productStateTrackDuplicateEvents",ce="productStateGHFormType",le="productStateGHInitialEventSend";var de=new WeakSet;function ue(){["allExperimentsInProductStateStatistics"].forEach((e=>this.productStorageService.delete(e)))}const he=class{constructor(e){var t,i;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t=this,i=de),i.add(t),this.trace=e.get("TraceService"),this.localization=e.get("LocalizationService"),this.productIdentityService=e.get("ProductIdentityService"),this.windowService=e.get("WindowService"),this.fileService=e.get("FileService"),this.statisticsService=e.get("StatisticsService"),this.timeCounterService=e.get("TimeCounterService"),this.proxyService=e.get("ProxyService"),this.externalSettingsService=e.get("ExternalSettingsService"),this.productStorageService=e.get("ProductStorageService"),this.environmentVarsService=e.get("EnvironmentVarsService"),this.updateService=e.get("UpdateService"),this.threatsService=e.get("ThreatService"),this.productStateStatisticsService=e.get("ProductStateStatisticsService"),this.ipcService=e.get("IpcService"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this._initializeAsarMd5OnStart(),function(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}(this,de,ue).call(this)}_initializeAsarMd5OnStart(){this.iniAsarMd5=this.getAsarMd5()}isFirstLaunch(){return this.productIdentityService.isFirstLaunch()}markProductLaunched(){this.productIdentityService.setIsFirstLaunch(!1);const e=`${this.environmentVarsService.expandEnvironmentVar(V.l4)}${this.updateService.getProductHotfix()}`;this.productStorageService.delete(le),this.productStorageService.set(te,e)}getLocalization(){return this.localization.getLocalization()}checkAsarIntegrity(){const e=this.getAsarMd5();this.iniAsarMd5&&e&&this.iniAsarMd5===e||this.windowService.relaunchGui()}getAsarMd5(){const e=`${this.productIdentityService.getCurrentDirectory()}\\resources\\${j.uR}`;return this.fileService.getMd5OfFile(e)}scheduleTelemetrySending(){const e=864e5,t=this.productStorageService.get("telemetrySendTimestamp"),i=()=>{this.statisticsService.sendStatisticsIfAllowed({source:"guiTelemetry",action:"send"}),this.productStorageService.set("telemetrySendTimestamp",Date.now())};(!t||Date.now()-t>e)&&i(),this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:24,listener:i.bind(this),listenerLabel:"sendTelemetryCallback"}),this._utilizeWrongInitTime({typeOfEvent:"interval",wrongHoursEvent:e,listenerLabel:"sendTelemetryCallback"})}_utilizeWrongInitTime({typeOfEvent:e,wrongHoursEvent:t,listenerLabel:i}){var s;const r=this.timeCounterService.getIntervalInitTimes();(null==r||null===(s=r[t])||void 0===s?void 0:s[i])&&this.timeCounterService.deleteTimeEventListener({typeOfEvent:e,hoursEvent:t,listenerLabel:i})}sendStatisticsAboutProxy(){if(!this.productStorageService.get("isProxyConfigurationCheckAlreadyDone")){const{defaultProxy:{proxyAuth:{userName:e,password:t}}}=this.proxyService.getProxySettings();this.statisticsService.sendStatisticsIfAllowed({source:"proxy_isProxyConfigured",action:"check",value:Boolean(e)&&Boolean(t)}),this.productStorageService.set("isProxyConfigurationCheckAlreadyDone",!0)}}isGetPremiumByUrl(){return this.externalSettingsService.isGetPremiumByUrl()}forceRelaunchGui(){this.windowService.relaunchGui()}setElectronVersion(e){this.productIdentityService.setElectronVersion(e)}getFeaturesEnablingState(){return{isEmailNotificationsEnabled:this.externalSettingsService.isEmailNotificationsEnabled(),isMalwareScanEnabled:this.externalSettingsService.isMalwareScanEnabled(),isManualRegistrationOpenEnabled:this.externalSettingsService.isManualRegistrationOpenEnabled(),isUserRegistrationEnabled:this.externalSettingsService.isUserRegistrationEnabled()}}getUiElementsConfiguration(){return this.externalSettingsService.getUiElementsConfiguration()}};var ge=i(4942),Se=i(74175);const pe=class{constructor(e){(0,ge.Z)(this,"getLatestRDPAgreementText",(()=>{const e=this.getAgreementsInfo(),t=(0,p.safeParseJson)(e[Se.Z.rdp].tag,this.trace).fileName||b.ZD;return this.getAgreementTextByName(t)})),(0,ge.Z)(this,"getLatestEtlAgreementText",(()=>{const e=this.getAgreementsInfo(),t=(0,p.safeParseJson)(e[Se.Z.rdpEtl].tag,this.trace).fileName||b.ZD;return this.getAgreementTextByName(t)})),this.trace=e.get("TraceService"),this.fileService=e.get("FileService"),this.agreementsService=e.get("AgreementsService"),this.productIdentityService=e.get("ProductIdentityService")}getLastAcceptedAgreement(e){const t=this.getAllAcceptanceFacts(),i=this.agreementsService.getAllAgreements(),s=t.filter((t=>t.accepted&&t.agreementId===e)).map((e=>i.find((t=>t.version===e.version)))).reduce(((e,t)=>{const i=parseInt((0,p.safeParseJson)(t.tag,this.trace).revision,10)||b.Ds;return i>e?i:e}),b.Ds),r=i.find((t=>(parseInt((0,p.safeParseJson)(t.tag,this.trace).revision,10)||b.Ds)===s&&t.id===e));if(r){const{fileName:e=b.ZD}=(0,p.safeParseJson)(r.tag,this.trace)||{},t=`${this.productIdentityService.getCurrentDirectory()}\\${e}`;return this.fileService.readTextFile(t)}return""}getAgreementsInfo(){return this.agreementsService.getAgreements()}getAcceptanceFactsWithoutRdp(){return this.agreementsService.getAcceptanceFactsWithoutRdp()}getAllAcceptanceFacts(){return this.agreementsService.getAllAcceptanceFacts()}getAgreementTextByName(e){return this.agreementsService.getAgreementTextByName(e)}getNotAcceptedAgreementsText(){return this.agreementsService.getNotAcceptedAgreementsText()}getActualNotAcceptedAgreementsInfo(){return this.agreementsService.getActualNotAcceptedAgreementsInfo()}registerAcceptanceFacts(e){this.agreementsService.registerAcceptanceFacts(e)}subscribeOnDiscoveryEvent(){}checkAgreementsAcceptance(){this.agreementsService.areThereNotAcceptedAgreements()&&(this.agreementsService.showAgreementBalloon(),this.agreementsService.scheduleAcceptAgreementsNotification())}},me=class{constructor(e){this.trace=e.get("TraceService"),this.typesOfObjectsToDetect=e.get("TypesOfObjectsToDetectService")}getAdwareRiskwarePornwareBlockStatus(){return this.typesOfObjectsToDetect.getAdwareRiskwarePornwareBlockStatus()}setAdwareRiskwarePornwareBlockStatus(e){return this.typesOfObjectsToDetect.setAdwareRiskwarePornwareBlockStatus(e)}},ve=class{constructor(e){this.trace=e.get("TraceService"),this.ksnService=e.get("KsnService"),this.timeCounterService=e.get("TimeCounterService"),this.permissionsCheckerService=e.get("PermissionsCheckerService"),this.productStorageService=e.get("ProductStorageService"),this.statisticsService=e.get("StatisticsService")}sendFeedback(e){this.ksnService.sendFeedback(e)}isFeedbackAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.Q7)}isPageFeedbackAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.ow)}setTimeoutsInitTime(){if(this.productStorageService.get("feedbackReminderInitTime"));else{const e=this.timeCounterService.getDateNowAsHours();this.productStorageService.set("feedbackReminderInitTime",e)}}updateAllTimeoutsInitTime(e,t){const i=this.productStorageService.get("feedbackReminderInitTime"),s=this.timeCounterService.getTriggeredTimeouts(),r=(null==s?void 0:s[t])||[];i&&e.forEach((e=>{r.includes(e)||this.timeCounterService.updateTimeEventInitTime({typeOfEvent:"timeout",hoursEvent:e,listenerLabel:t,newInitTime:i})}))}},we=class{constructor(e){}getCurrentBalloonChain(){}},be=class{constructor(e){this.trace=e.get("TraceService"),this.exploitPrevention=e.get("ExploitPreventionService"),this.permissionsCheckerService=e.get("PermissionsCheckerService")}getExploitPreventionStatus(){return this.exploitPrevention.getExploitPreventionStatus()}setExploitPreventionStatus(e){return this.exploitPrevention.setExploitPreventionStatus(e)}getSystemProcessesMemoryProtectionStatus(){return this.exploitPrevention.getSystemProcessesMemoryProtectionStatus()}setSystemProcessesMemoryProtectionStatus(e){return this.exploitPrevention.setSystemProcessesMemoryProtectionStatus(e)}isExploitPreventionAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.qK)}},fe=class{constructor(e){this.trace=e.get("TraceService"),this.passwordProtection=e.get("PasswordProtectionService"),this.permissionsCheckerService=e.get("PermissionsCheckerService")}getPasswordProtectionState(){return this.passwordProtection.getPasswordProtectionState()}setNewPassword(e){return this.passwordProtection.setNewPassword(e)}savePassword(e){return this.passwordProtection.savePassword(e)}getPassword(){return this.passwordProtection.getPassword()}verifyPassword({password:e}){return this.passwordProtection.verifyPassword(e)}changePassword({oldPassword:e,newPassword:t}){return this.passwordProtection.changePassword(e,t)}setShouldBePasswordSavedPerSession(e){this.passwordProtection.setShouldBePasswordSavedPerSession(e)}getShouldBePasswordStoredPerSession(){return this.passwordProtection.getShouldBePasswordStoredPerSession()}isPasswordProtectionAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.eX)}};var Ce=i(37515);const Re=class{constructor(e){this.trace=e.get("TraceService"),this.agreementsService=e.get("AgreementsService"),this.timeCounterService=e.get("TimeCounterService"),this.windowService=e.get("WindowService"),this.productStorage=e.get("ProductStorageService"),this.electron=e.get("electron"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this.upgradeService=e.get("UpgradeService"),this.internalCacheService=e.get("InternalCacheService"),this.productIdentityService=e.get("ProductIdentityService")}isForceUpgrade(){return Ce.Z.notAccepted===this.agreementsService.getAcceptedAgreementsState()}_handleTfuInstallationRequest(e,t){this.electron.ipcMain.once(l.d_,((e,t)=>{const i=this.productIdentityService.getSessionId();this.uiRegistrationService.sendResponse(1,t.installationAction,(0,p.safeJsonStringify)({sessionId:i}))}))}subscribeOnTfuInstallationStatus(){const e={OnInstallationStarted:()=>{this.internalCacheService.setCacheValue("tfuIsInstallationInProgress",!0)},OnInstallationFinished:()=>this.internalCacheService.setCacheValue("tfuIsInstallationInProgress",!1),OnUninstallationStarted:()=>{},OnUninstallationFinished:()=>{}};this.upgradeService.subscribe(e)}};var Me=i(28103);const ye=class{constructor(e){this.trace=e.get("TraceService"),this.permissionsCheckerService=e.get("PermissionsCheckerService"),this.statisticsService=e.get("StatisticsService")}sendStatistics({source:e,action:t,value:i,useSessionGuid:s}){if(this.isStatisticsSendingAllowed()){const r=s?this.getSessionGuidByHtmlElementId(e):void 0;this.statisticsService.sendStatistics({source:e,action:t,value:i,sessionGuid:r})}}isStatisticsSendingAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.cH)}getSessionGuidByHtmlElementId(e){const t={[Me.bCk]:F,[Me.Vq4]:F}[e];return t?this.statisticsService.getGuidRelatedToFeature(t):b.ZD}};var Ie=i(71856),Te=i(51436),Pe=i(89342);function Ee(e,t){ke(e,t),t.add(e)}function Ae(e,t,i){ke(e,t),t.set(e,i)}function ke(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function De(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var Fe=new WeakMap,Le=new WeakMap,Be=new WeakSet,_e=new WeakSet,Ne=new WeakSet;function xe(){const e=Boolean(this.productStorage.get(le));this.productIdentityService.isFirstLaunch()&&!e&&(this.productStateStatisticsService.setRegistrationGHEvent({data:{registrationFormShown:this._isMarketoFormShownInOlderAppVersions(),registered:this.isUserRegistered()},eventName:Te.uI.initialRegistrationState}),this.setTargetingRegistrationPSEvent(),this.productStorage.set(le,!0))}function Oe(){De(this,Ne,Ue).call(this)&&this.setTargetingRegistrationPSEvent()}function Ue(){return this.productStorage.get(ce)!==this.userRegistrationService.getRawRegistrationFormType()}const We=class{constructor(e){Ee(this,Ne),Ee(this,_e),Ee(this,Be),Ae(this,Fe,{writable:!0,value:null}),Ae(this,Le,{writable:!0,value:void 0}),this.trace=e.get("TraceService"),this.electron=e.get("electron"),this.productStorage=e.get("ProductStorageService"),this.windowService=e.get("WindowService"),this.timeCounterService=e.get("TimeCounterService"),this.userRegistrationService=e.get("UserRegistrationService"),this.productIdentityService=e.get("ProductIdentityService"),this.externalSettingsService=e.get("ExternalSettingsService"),this.ipcService=e.get("IpcService"),this.productStateStatisticsService=e.get("ProductStateStatisticsService"),this.uiRegistrationService=e.get("KartUiRegistrationService"),this._THREE_HOURS=3,this._registrationStepDraftEvents={},De(this,Be,xe).call(this),De(this,_e,Oe).call(this)}_isMarketoFormShownInOlderAppVersions(){const e=(0,p.safeJsonStringify)(this.timeCounterService.getIntervalInitTimes());return e.includes("showMarketoForm")||e.includes("openGuiForUserRegistration")}_isDuplicatedFailurePsEvent({eventName:e,message:t,result:i}){if([Te.bx.noInternetErr,Te.bx.apiFailErr].includes(t)){const s=(0,p.safeParseJson)(this.productStorage.get(oe))||{};return!!s[e]||(s[e]={message:t,result:i},this.productStorage.set(oe,(0,p.safeJsonStringify)(s)),!1)}return!1}setMarketoOnLoadPSEvent({eventName:e,message:t,result:i}){this._isDuplicatedFailurePsEvent({eventName:e,message:t,result:i})||this.productStateStatisticsService.setRegistrationGHEvent({data:{message:t,result:i},eventName:e})}setRegistrationStepDraftEvent(e){this._registrationStepDraftEvents[e.eventName]={...this._registrationStepDraftEvents[e.eventName],...e},this._registrationStepDraftEvents[e.eventName].timestamp||(this._registrationStepDraftEvents[e.eventName].timestamp=this.productStateStatisticsService.getCurrentTrustedDateTime()),this.productStorage.set(ne,(0,p.safeJsonStringify)(this._registrationStepDraftEvents))}setRegistrationStepPSEvent({eventName:e,data:t}){const{timestamp:i}=this._registrationStepDraftEvents[e];this.productStateStatisticsService.setRegistrationGHEvent({timestamp:i,eventName:e,data:{...t,closeTimestamp:this.productStateStatisticsService.getCurrentTrustedDateTime()}}),this.deleteRegistrationEventDrafts(),delete this._registrationStepDraftEvents[e]}sendIncompletePsRegistrationEvents(e){const t=(0,p.safeParseJson)(this.productStorage.get(ne))||{},i=t[Te.uI.showStep1],s=t[Te.uI.showStep2],r=this.productStateStatisticsService.getPreviousAliveTimestamp()||e;if(i){const{eventName:t,timestamp:s,fieldsState:a}=i;this.productStateStatisticsService.setRegistrationGHEvent({eventName:t,timestamp:s,data:{fieldsState:a,closeTimestamp:r,closeTrigger:e?Te.Tf.closeUi:Te.Tf.exitApp}})}if(s){const{eventName:t,timestamp:i,fieldsState:a}=s;this.productStateStatisticsService.setRegistrationGHEvent({eventName:t,timestamp:i,data:{fieldsState:a,closeTimestamp:r,closeTrigger:e?Te.Tf.closeUi:Te.Tf.exitApp}})}this.deleteRegistrationEventDrafts()}deleteRegistrationEventDrafts(){this.productStorage.delete(ne)}deleteDuplicatedRegistrationEvents(){this.productStorage.delete(oe)}subscribeDraftPSEventsOnMainWindowClose(){this.windowService.getMainWindow().once("close",(()=>{const e=this.productStateStatisticsService.getCurrentTrustedDateTime();this.sendIncompletePsRegistrationEvents(e)}))}getMarketoFormConfig(){return this.externalSettingsService.getMarketoFormConfig()}checkIsMarketoFormWasSubmitted(){return Boolean(this.productStorage.get("isMarketoWasSubmitted"))}markFormAsSubmitted(){this.productStorage.set("isMarketoWasSubmitted",!0)}scheduleUserRegistration(){const e=this.checkIsMarketoFormWasSubmitted(),t=this.isUserRegistrationEnabled(),i=this.isUserRegistered(),s=this.productStorage.get(ae)||b.uL,r=this.userRegistrationService.getRegistrationSchedulerInterval();if(e||!t||i)this.deleteUserRegistrationSchedule(s);else{var a;s!==r&&this.deleteUserRegistrationSchedule(s),this.productStorage.set(ae,r);const e="openGuiForUserRegistration",t=this.timeCounterService.getIntervalInitTimes(),i=this.timeCounterService.getDateNowAsHours(),n=null==t||null===(a=t[r])||void 0===a?void 0:a[e];n&&i-n>=r&&(this.deleteUserRegistrationSchedule(r),this.openGuiForUserRegistration()),this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:r,listener:this.openGuiForUserRegistration.bind(this),listenerLabel:e})}}deleteUserRegistrationSchedule(e){this.timeCounterService.deleteTimeEventListener({typeOfEvent:"interval",hoursEvent:e,listenerLabel:"openGuiForUserRegistration"})}subscribeGuiOnShowMarketoForm({spaCallbackChannel:e}){this.spaMarketoFormListener=this.ipcService.createSpaCallback(e)}openGuiForUserRegistration(){const{net:e}=this.electron,{marketoScriptUrl:t}=this.getMarketoFormConfig(),i=e.request(t);i.setHeader("Cache-Control","no-cache");const s=setTimeout((()=>{i.abort(),clearTimeout(s),this.trace.error("UserRegistrationLogic: openGuiForUserRegistration: request was aborted after 30sec")}),b.nU);i.on("response",(e=>{e.on("error",(e=>{this.trace.error(`UserRegistrationLogic: openGuiForUserRegistration: response: error event: ${e}`),clearTimeout(s)})),e.on("data",(()=>{s&&clearTimeout(s)})),e.on("end",(()=>{const e=this.windowService.getMainWindow();null!=e&&e.isVisible()?this.spaMarketoFormListener():e?e.on("show",(()=>{this.spaMarketoFormListener()})):this.windowService.createMainWindow().on("show",(()=>{this.spaMarketoFormListener()}))}))})),i.on("error",(e=>{this.trace.error(`UserRegistrationLogic: openGuiForUserRegistration: request: error while request: ${e}. Main window won't be shown!`)})),i.end()}isUserRegistered(){return this.userRegistrationService.isUserRegistered()}applyRegistrationCode(e){return this.userRegistrationService.applyRegistrationCode(e)}registerUser(e){return this.userRegistrationService.register(e)}getMarketoUserInput(){return(0,p.safeParseJson)(this.productStorage.get(re))||{}}saveMarketoUserInput(e){this.productStorage.extendValue(re,e)}deleteMarketoUserInput(){this.productStorage.delete(re)}isUserRegistrationEnabled(){return this.externalSettingsService.isUserRegistrationEnabled()}showFailUploadRegistrationFormBalloon(){}getRegistrationFormType(){return this.userRegistrationService.getRegistrationFormTypeSafe()}_prepareMarketoData(){const e=this.getMarketoUserInput()||{},{firstName:t,lastName:i,email:s,companyName:r,country:a,phone:n,numOfPc:o,province:c,isPrivacyPolicyAccepted:l}=e,{fieldIds:d}=this.getMarketoFormConfig(),u=this.getRegistrationCode(),h=this.getRegistrationFormType(),g=this.productIdentityService.getPpcsId();return{[d.companyFieldId]:r||t,[d.countryFieldId]:(null==a?void 0:a.value)||a||"Afghanistan",[d.stateFieldId]:(null==c?void 0:c.value)||c,[d.emailFieldId]:s,[d.firstNameFieldId]:t,[d.lastNameFieldId]:i,[d.subscriptionSingleOptInFieldId]:l,[d.numberOfPCFieldId]:o||b.OL,[d.phoneFieldId]:n,[d.authCode]:u,[d.kartCustomerType]:h===Pe.eu?"bonus":"default",[d.ppcsId]:g}}submitMarketoFormInHiddenWindow(){if(n(this,Fe))return C.MR;let e;o(this,Fe,this.windowService.createBrowserWindow(j.B2));const t=()=>{this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:this._THREE_HOURS,listener:this.submitMarketoFormInHiddenWindow.bind(this),listenerLabel:"submitMarketoFormInHiddenWindow"})},i=this.getMarketoFormConfig(),s=()=>{var e,t;null===(e=n(this,Fe))||void 0===e||null===(t=e.webContents)||void 0===t||t.send(f.h6,{type:"load-marketo",message:i})},r=()=>{var e,t;const i={eventName:Te.uI.formLoadingSilent,message:Te.bx.success,result:!0};this.setMarketoOnLoadPSEvent(i);const s=this._prepareMarketoData();null===(e=n(this,Fe))||void 0===e||null===(t=e.webContents)||void 0===t||t.send(f.h6,{type:"submit-marketo",message:s})},a=e=>{this.sendHttpRequest({url:i.marketoFormUrl}).then((()=>{const t={eventName:e,message:Te.bx.apiFailErr,result:!1};this.setMarketoOnLoadPSEvent(t)})).catch((()=>{const t={eventName:e,message:Te.bx.noInternetErr,result:!1};this.setMarketoOnLoadPSEvent(t)})),t(),u()},c=()=>{const e={eventName:Te.uI.scriptLoadingSilent,message:Te.bx.success,result:!0};this.setMarketoOnLoadPSEvent(e)},l=()=>{const t={eventName:Te.uI.formSubmission,message:Te.bx.success,result:!0};this.setMarketoOnLoadPSEvent(t),this.markFormAsSubmitted(),this.deleteMarketoUserInput(),this.productStorage.delete(se),this.deleteDuplicatedRegistrationEvents(),this.completeRegistrationProcess(),this.timeCounterService.deleteTimeEventListener({typeOfEvent:"interval",hoursEvent:this._THREE_HOURS,listenerLabel:"submitMarketoFormInHiddenWindow"}),clearTimeout(e),u()},d=(t,{type:i,message:n})=>{switch(i){case"ready":s();break;case"request-fields-data":r();break;case"script-loading-success":c();break;case"script-loading-fail":a(Te.uI.scriptLoadingSilent);break;case"form-loading-fail":a(Te.uI.formLoadingSilent);break;case"submission-started":e=setTimeout((()=>{a(Te.uI.formSubmission)}),b.nU);break;case"submission-completed":l()}},u=()=>{var e;this.electron.ipcMain.removeListener(f.h6,d),null===(e=n(this,Fe))||void 0===e||e.close(),o(this,Fe,null)};this.electron.ipcMain.on(f.h6,d)}isMarketoWaitingSubmission(){return this.productStorage.get(se)}setMarketoWaitingSubmission(e){this.productStorage.set(se,e)}checkAndSubmitMarketoSilent(){this.isMarketoWaitingSubmission()&&this.submitMarketoFormInHiddenWindow()}subscribeMarketoOnMainWindowClose(){this.windowService.getMainWindow().once("close",(()=>{this.isMarketoWaitingSubmission()?this.checkAndSubmitMarketoSilent():this.setIsRegistrationInProgress(!1)}))}getCurrentCountryName(e){const t=this.userRegistrationService.getRegion(),i=this.externalSettingsService.getCountryCodesMapping();if(null!=i&&i[t]){var s;const r=i[t];return null===(s=e.find((e=>r.includes(e.value))))||void 0===s?void 0:s.value}return b.ZD}showAboutFreeLessonModal(){this.windowService.getModalWindowById(m)||this.windowService.createModalWindow({id:m,width:624,options:{modal:!1,parent:null}})}getRegistrationCode(){return this.userRegistrationService.getRegistrationCode()}async sendHttpRequest({url:e,timeout:t=b.nU}){const{net:i}=this.electron,s=i.request(e);s.setHeader("Cache-Control","no-cache");const r=setTimeout((()=>{s.abort(),clearTimeout(r),this.trace.error("UserRegistrationLogic: sendHttpRequest: request was aborted after 30sec")}),t);return new Promise(((e,t)=>{s.on("response",(i=>{i.on("error",(e=>{this.trace.error(`UserRegistrationLogic: sendHttpRequest: response: error event: ${e}`),clearTimeout(r),t(e)})),i.on("data",(()=>{r&&clearTimeout(r)})),i.on("end",(()=>{e()}))})),s.on("error",(e=>{this.trace.error(`UserRegistrationLogic: sendHttpRequest: request: error while request: ${e}`),t(e)})),s.end()}))}setIsRegistrationInProgress(e){this.userRegistrationService.setIsRegistrationInProgress(e)}deleteSavedCurrentFormType(){this.userRegistrationService.deleteSavedCurrentFormType()}completeRegistrationProcess(){this.setIsRegistrationInProgress(!1),this.deleteSavedCurrentFormType()}subscribeOnRegistrationSettingsChanges(){this.uiRegistrationService.setRegistrationSettingsUpdatedCallback((()=>{this.scheduleUserRegistration(),this.setTargetingRegistrationPSEvent()}))}setTargetingRegistrationPSEvent(){if(!this.userRegistrationService.isUserRegistered()){const e=this.productIdentityService.getEdition()===A.H?Ie.Wx:Ie.ov,t=this.userRegistrationService.getFeatureFlagValue(e),i=this.userRegistrationService.getRegistrationSchedulerInterval(),s=this.userRegistrationService.getRawRegistrationFormType();this.productStateStatisticsService.setRegistrationGHEvent({data:{inTarget:t!==b.ZD,freq:i,formType:s},eventName:Te.uI.targeting})}}setSpaRegistrationFormTypeUpdateSubscriber({spaCallbackChannel:e}){o(this,Le,this.ipcService.createSpaCallback(e))}subscribeOnRegistrationFormTypeUpdate(){this.uiRegistrationService.addFeatureFlagUpdatedCallback((()=>{De(this,Ne,Ue).call(this)&&("function"==typeof n(this,Le)&&n(this,Le).call(this),this.setTargetingRegistrationPSEvent())}))}},ze=class{constructor(e){this.trace=e.get("TraceService"),this.dumpReportsService=e.get("DumpReportsService"),this.agreementsService=e.get("AgreementsService"),this.electron=e.get("electron")}subscribeOnDumpReportReady(){const e={onDumpReportChanged:e=>{this._subscribeOnDeclineReportSending(),this._subscribeOnSendDumpReport()},onEtlReportChanged:e=>{this._subscribeOnDeclineEtlReportSending(),this._subscribeOnSendEtlReport()}};this.dumpReportsService.subscribe(e)}_subscribeOnDeclineReportSending(){this.electron.ipcMain.on(l.yh,(()=>{this.dumpReportsService.declineProductReport()}))}_subscribeOnSendDumpReport(){this.electron.ipcMain.on(l._t,((e,t)=>{const i=this.agreementsService.getAgreements(),s={...this.agreementsService.getAllAcceptanceFacts().find((e=>e.version===i[Se.Z.rdp].version)),factModiticationDate:Date.now(),accepted:!0};this.agreementsService.registerAcceptanceFact(s),this.dumpReportsService.sendDumpReport(t.issueText)}))}_subscribeOnDeclineEtlReportSending(){this.electron.ipcMain.on(l.yq,(()=>{this.dumpReportsService.declineEtlReport()}))}_subscribeOnSendEtlReport(){this.electron.ipcMain.on(l.lA,(e=>{const t=this.agreementsService.getAgreements(),i={...this.agreementsService.getAllAcceptanceFacts().find((e=>e.version===t[Se.Z.rdpEtl].version)),factModiticationDate:Date.now(),accepted:!0};this.agreementsService.registerAcceptanceFact(i),this.dumpReportsService.sendEtlReport()}))}},Ge="uiUsage";var Ve=i(19536);const Ke=class{constructor(e){this.trace=e.get("TraceService"),this.productStateStatisticsService=e.get("ProductStateStatisticsService"),this.productStorageService=e.get("ProductStorageService"),this.ipmService=e.get("IpmService"),this.userRegistrationService=e.get("UserRegistrationService"),this.externalSettingsService=e.get("ExternalSettingsService")}sendPreviousMainWindowProductStateEvents(){this.productStateStatisticsService.sendPreviousProductStateEvent(!1)}sendOldPSEventsAndScheduleAliveTimestamp(){this.productStateStatisticsService.sendPreviousProductStateEvent(!0),this._scheduleProductAliveTimestamp()}_scheduleProductAliveTimestamp(){const e=this.productStorageService.get(J),t=()=>this.productStorageService.set(J,this.productStateStatisticsService.getCurrentTrustedDateTime());this.productStateStatisticsService.setPreviousAliveTimestamp(e),t(),setInterval(t,5*b.N5)}sendAdditionalInfoUiEvent(e){this.productStateStatisticsService.setAdditionalInfoEvent(Ge,e)}setAdditionalInfoRegistrationEvent(e){const t={...e,dateTime:this.productStateStatisticsService.getCurrentTrustedDateTime()};this.productStateStatisticsService.setRegistrationUsageEvent(t)}setAdditionalInfoClickEvent(e){const t={...e,dateTime:this.productStateStatisticsService.getCurrentTrustedDateTime()};this.productStateStatisticsService.setAdditionalInfoEvent("click",t)}getUserSidIfAllowed(){return this.productStateStatisticsService.getSystemUserIdIfAllowed()}setAdditionalInfoExperimentEvent(e){this.productStateStatisticsService.setAdditionalInfoExperimentEvent(e)}getExperimentUsageEvent(){return this.productStateStatisticsService.getExperimentUsageEvent()}saveDraftUiUsageEvent(e){const t={id:e,data:b.ZD,openDateTime:this.productStateStatisticsService.getCurrentTrustedDateTime(),closeDateTime:null};this.productStorageService.extendValue(X,{[e]:t})}sendUiUsageEvent(e){const t=(0,p.safeParseJson)(this.productStorageService.get(X))||{};this.sendAdditionalInfoUiEvent({...t[e],closeDateTime:this.productStateStatisticsService.getCurrentTrustedDateTime()}),this.productStateStatisticsService.deleteCachedWindowsUiUsageEventByWinId(e)}saveMarketoFormSnapshot(e){const t={...e,dateTime:this.productStateStatisticsService.getCurrentTrustedDateTime()};this.productStorageService.set(Q,(0,p.safeJsonStringify)(t))}deleteMarketoFormSnapshot(){this.productStorageService.delete(Q)}resendRegistrationUsageEvent(){const e=this.productStorageService.get(ee),t=this.userRegistrationService.isUserRegistered();if(e||!t)return C.MR;const i=this.productStateStatisticsService.getLastRegistrationEvent();if(t&&!e&&!i){const e={type:Ve.wM,dateTime:this.productStateStatisticsService.getCurrentTrustedDateTime(),errorCode:C.MR,errorMessage:b.ZD,formId:null,formSeqNumber:null,filledFieldIds:null,unfilledFieldIds:null,invalidFieldIds:null};this.productStateStatisticsService.setRegistrationUsageEvent(e),this.productStorageService.set(ee,!0)}}addEventForKesMigration({eventName:e,data:t}){this.productStateStatisticsService.addEventForKesMigration(e,t)}},He=class{constructor(e){this.productStorageService=e.get("ProductStorageService"),this.trace=e.get("TraceService"),this.externalSettingsService=e.get("ExternalSettingsService"),this.productIdentityService=e.get("ProductIdentityService"),this.windowService=e.get("WindowService"),this._isRegistrationMuted=!1}setOnboardingInfo(e){this.productStorageService.set(Y,(0,p.safeJsonStringify)(e))}getOnboardingInfo(){const e=this.externalSettingsService.isOnboardingEnabled(),t=(0,p.safeParseJson)(this.productStorageService.get(Y))||{};return{...t,isOnboardingFirstLaunch:t.isOnboardingFirstLaunch??!0,isOnboardingFirstStop:t.isOnboardingFirstStop??!0,isEnabled:e}}isCleanInstallation(){return this.productIdentityService.isCleanInstallation()}muteBalloons(){}unmuteBalloons(){}subscribeBlOnCloseMainWindow(){this.windowService.getMainWindow().once("close",(()=>{const e=this.getOnboardingInfo();this.setOnboardingInfo({...e,isInProgress:!1,isOnboardingFirstStop:!1}),this.unmuteNotifications()}))}isRegistrationFormMuted(){return this._isRegistrationMuted}muteNotifications(){this._isRegistrationMuted=!0,this.muteBalloons()}unmuteNotifications(){this._isRegistrationMuted=!1,this.unmuteBalloons()}};var $e=i(66624),Ze=i(8853),qe=i(43147),je=i(81053),Je=i(72728),Ye=i(12416),Xe=i(64856);function Qe(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var et=new WeakSet;class tt extends Xe.default{constructor(e,t,i){var s,r;super(e,t,i),function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(s=this,r=et),r.add(s),this.statisticsService=i.get("StatisticsService"),this.localizationService=i.get("LocalizationService"),this.upgradeService=i.get("UpgradeService"),this.productIconClickNotifier=t.getProductIconClickNotifier(),this.windowsInteraction=t.getWindowsInteraction(),this.productStateStatisticsService=i.get("ProductStateStatisticsService"),this.productStorageService=i.get("ProductStorageService"),this.electron=e,this._isGuiToBeRelaunched=!1,this._modalWindows={}}_resetWindowZoom(e){null==e||e.webContents.setZoomFactor(b.OL),null==e||e.webContents.setZoomLevel(b.Ds)}createMainWindow(){if(this.mainWindow)return this.mainWindow;let e=new this.BrowserWindow({width:800,height:600,webPreferences:{nodeIntegration:!0,sandbox:!1,contextIsolation:!1,disableDialogs:!0},frame:!1,resizable:!1,show:!1,alwaysOnTop:!0});this.mainWindow=e,Qe(this,et,it).call(this),e.once("ready-to-show",(()=>this._resetWindowZoom(e))),e.on("show",(()=>e.setAlwaysOnTop(!1)));const t=`file://${this.app.getAppPath()}/index.html`;return e.loadURL(t),e.once("closed",(()=>{e=null,this.mainWindow=null})),e.on("minimize",(()=>{this.statisticsService.sendStatisticsIfAllowed({source:"mainWindow",action:"minimize"})})),e.on("restore",(()=>{this._resetWindowZoom(e),this.statisticsService.sendStatisticsIfAllowed({source:"mainWindow",action:"restore"})})),e}showMainWindowAfterCreate(){this.mainWindow.show(),this.statisticsService.sendStatisticsIfAllowed({source:"mainWindow",action:"open"})}getModalWindowById(e){return this._modalWindows[e]}createModalWindow({id:e,data:t={},width:i,options:s={}}){if(!e)throw new Error(`WindowService: createModalWindow: invalid input params: id=${e}`);const r=i||352,{workAreaSize:a}=this.electron.screen.getPrimaryDisplay(),n=Math.ceil((a.width-r)/2),o=Math.ceil((a.height-100)/2);this._modalWindows[e]=new this.BrowserWindow({skipTaskbar:!0,modal:!0,show:!1,x:n,y:o,width:r,height:100,webPreferences:{nodeIntegration:!0,sandbox:!1,contextIsolation:!1},frame:!1,resizable:!1,alwaysOnTop:!0,minimizable:!1,...s});const c=`file://${this.app.getAppPath()}/balloons/index.html?id=${e}`,l=(t,{height:i})=>{const s=Math.ceil(i),o=Math.ceil((a.height-s)/2);this._modalWindows[e].setSize(r,s),this._modalWindows[e].setPosition(n,o)},d=()=>{const t={id:`balloon_${R[e].name}`,data:b.ZD,openDateTime:this.productStateStatisticsService.getCurrentTrustedDateTime(),closeDateTime:null};var i;Qe(this,et,it).call(this),this.statisticsService.sendStatisticsIfAllowed({source:`balloon_${R[e].name}`,action:"show"}),this.productStorageService.extendValue(X,{[e]:t}),s.alwaysOnTop||null===(i=this._modalWindows[e])||void 0===i||i.setAlwaysOnTop(!1)};return this.electron.ipcMain.once(`resize-${e}-window`,l),this.electron.ipcMain.on(`spa${e}-ready-to-show`,(()=>{try{this._modalWindows[e].webContents.send(f.cv,t)}catch(e){}})),this._modalWindows[e].once("ready-to-show",(()=>this._resetWindowZoom(this._modalWindows[e]))),this._modalWindows[e].once("resize",(()=>{this._modalWindows[e].once("show",d),this._modalWindows[e].show()})),this._modalWindows[e].once("close",(()=>{this.electron.ipcMain.removeListener(`resize-${e}-window`,l),this.statisticsService.sendStatisticsIfAllowed({source:`balloon_${R[e].name}`,action:"close"});const t=(0,p.safeParseJson)(this.productStorageService.get(X)),i=null==t?void 0:t[e],s={id:`balloon_${R[e].name}`,data:i?b.ZD:"no event",openDateTime:(null==i?void 0:i.openDateTime)||null,closeDateTime:this.productStateStatisticsService.getCurrentTrustedDateTime()};this.productStateStatisticsService.setAdditionalInfoEvent(Ge,s),this.productStateStatisticsService.deleteCachedWindowsUiUsageEventByWinId(e),delete this._modalWindows[e],Qe(this,et,it).call(this)})),this._modalWindows[e].loadURL(c),this._modalWindows[e]}setIsGuiToBeRelaunched(e){this._isGuiToBeRelaunched=e}getIsGuiToBeRelaunched(){return this._isGuiToBeRelaunched}relaunchGui(){this.upgradeService.refreshResourcesSymlink(),this.electron.app.relaunch({args:process.argv.slice(1).concat(["--relaunch","--minimized-in-tray"])}),this.electron.app.exit()}createBalloon(e){var t;const{workAreaSize:i}=this.electron.screen.getPrimaryDisplay();let s=new this.BrowserWindow({skipTaskbar:!0,show:!1,frame:!1,resizable:!1,alwaysOnTop:!0,webPreferences:{nodeIntegration:!0,sandbox:!1,contextIsolation:!1},sandbox:!0,minimizable:!1});const r=`file://${this.app.getAppPath()}/balloons/index.html?id=${e}`,a=(e,{height:t,width:r})=>{const a=Math.ceil(t),n=Math.ceil(r),o=Math.ceil(i.height)-a-25,c=Math.ceil(i.width)-n-25;s.setResizable(!0),s.setSize(n,a),s.setResizable(!1),s.setPosition(c,o)};return s.once("ready-to-show",(()=>this._resetWindowZoom(s))),s.once("closed",(()=>{var t;null===(t=this.electron.ipcMain)||void 0===t||t.removeListener(`resize-${e}-window`,a),s=null})),s.loadURLWithPath=async()=>{try{await s.loadURL(r)}catch(e){}},null===(t=this.electron.ipcMain)||void 0===t||t.on(`resize-${e}-window`,a),s.once("resize",(()=>{s.setAlwaysOnTop(!0,"screen-saver"),s.show()})),s}subscribeOnProductIconClick(){const e={onIconClick:()=>{this.showMainWindow()}};this.productIconClickNotifier.subscribe(e)}createBrowserWindow(e,t={}){let i=new this.BrowserWindow({width:100,height:100,webPreferences:{nodeIntegration:!0,sandbox:!1,contextIsolation:!1,disableDialogs:!0},frame:!1,resizable:!1,show:!1,alwaysOnTop:!1,...t});const s=`file://${this.app.getAppPath()}/${e}`;return i.loadURL(s),i.once("closed",(()=>i=null)),i}minimizeModalWindowById(e){this.getModalWindowById(e).minimize()}}function it(){const e=this.getMainWindow(),t=Object.keys(this._modalWindows).some((e=>{var t;return![m,v].includes(parseInt(e,10))&&(null===(t=this._modalWindows[e])||void 0===t?void 0:t.isVisible())}));null==e||e.setEnabled(!t)}const st=tt,rt=class{constructor(e,t,i){this.proxySettingsController=t.getProxySettingsController(),this.memoryCryptor=t.getMemoryCryptor(),this.ksnInfoDirectProvider=t.getKsnInfoDirectProvider(),this.trace=i.get("TraceService")}setProxySettings(e){this.proxySettingsController.setProxySettings(e)}getProxySettings(){let e={};return this.proxySettingsController.getProxySettings(e),e.value}checkProxy(e){const t={noDataAvailable:()=>{},handleCloudInfo:()=>{},setLastResultCode:t=>{e(0===t)}};let i=this.ksnInfoDirectProvider.asyncGetDirect(t);if(0===i)return i}transformStringToUnicode(e){let t=[].map.call(e,(e=>e.charCodeAt(0)));return t.push(0),t}encryptString(e){const t=[];return this.memoryCryptor.encryptString(e,t),t}decryptString(e){const t={};return this.memoryCryptor.decryptString(e,t)===C.MR?t.value:b.ZD}},at=class{constructor(e,t,i){this.fullScreenNotifier=t.getProductFullScreenChangeNotifier(),this.trace=i.get("TraceService")}subscribeOnScreenModeChange(e){this.fullScreenNotifier.subscribe(e)}getScreenMode(){const e={};return this.fullScreenNotifier.getState(e)!==C.MR?I.w.WINDOW:e.value}},nt=class{constructor(e,t,i){this.ksnInfoProvider=t.getKsnInfoProvider(),this.trace=i.get("TraceService"),this.ksnTransport=t.getKsnTransport()}getKsnInfo(e){const t={noDataAvailable:()=>{},handleCloudInfo:t=>{let i={allowed:t.m_whiteApplications,malware:t.m_malwareApplications,inProcessing:t.m_totalFiles};e(!1,i)},setLastResultCode:()=>{}};this.ksnInfoProvider.asyncGet(t)}sendFeedback(e){this.ksnTransport.sendFeedback(e)}},ot=class{constructor(e,t,i){this.api=t.getForbiddenApps(),this.trace=i.get("TraceService")}getAppList(){let e={};return 0!==this.api.getAppList(e)?{}:e&&e.value?e.value:{}}addAllowedApp(e){return this.api.addAllowedApp(e)}removeAllowedApp(e){return this.api.removeAllowedApp(e)}removeForbiddenApp(e){return this.api.removeForbiddenApp(e)}addForbiddenApp(e){return this.api.addForbiddenApp(e)}};var ct=i(83);const lt=class{constructor(e,t,i){this.reportProvider=t.getThreatReportProvider(),this.activityReport=t.getActivityReport(),this.trace=i.get("TraceService"),this.malwareScan=t.getMalwareScan(),this.malwareScanEventSubscription=t.getMalwareScanEventSubscription(),this.productStorageService=i.get("ProductStorageService"),this.downloadScan=t.getDownloadScan(),this.externalSettingsService=i.get("ExternalSettingsService"),this.permissionsCheckerService=i.get("PermissionsCheckerService")}getThreats(e,t){const i={};return this.reportProvider.getReport(e,t-e+b.OL,i)===C.MR?i.value.events:[]}getThreatsReportSize(){let e={};return this.reportProvider.getReportSize(e)!==C.MR?b.Ds:e.value}clearReport(){this.reportProvider.clearReport()}subscribeOnMalwareScan(e){return this.malwareScanEventSubscription.subscribe(e)}startMalwareScan(){return this.malwareScan.start()}stopMalwareScan(){return this.malwareScan.stop()}getLastMalwareScanInfo(){const e={},t={isScanWasInProgressWhileRequest:this.malwareScan.getLastState(e)===ct.s3,...e.value};return t.statistic.totalKsnFailedScanFiles=e.value.statistic.statisticsByFolder.reduce(((e,t)=>e+t.ksnFailedScanFiles),b.Ds),t}getActivityReport(e){const t={};return this.activityReport.getReport(e,t)!==C.MR?{}:t.value}getIsDownloadScanBalloonsEnabled(){return this.productStorageService.get(ie)??!0}setIsDownloadScanBalloonsEnabled(e){this.productStorageService.set(ie,e)}startDownloadsScan(){this.downloadScan.run()}stopDownloadsScan(){this.downloadScan.stop()}changeDownloadsScanState(){this.isDownloadsScanEnabled()?this.startDownloadsScan():this.stopDownloadsScan()}getDownloadsScanInfo(){const e={};return this.downloadScan.getInfo(e)===C.MR?e.value:{}}isDownloadsScanEnabled(){const e=this.externalSettingsService.isDownloadsScanEnabled(),t=this.getDownloadsScanInfo(),i=this.permissionsCheckerService.isFeatureEnabled(Ie.F7);return t.result===C.MR&&!!i&&e}addEventWithoutNotification(e){this.reportProvider.addEventWithoutNotification(e)}},dt=class{constructor(e,t,i){this.threatNotificationsSubscription=t.getThreatNotificationsSubscription(),this.trace=i.get("TraceService"),this.ksnFileReputation=t.getKsnFileReputationRequestSubscription()}subscribe(e){const t={onEvent:t=>(e(t),C.MR)};this.threatNotificationsSubscription.subscribe(t)}unsubscribe(){}subscribeOnDownloadsScan(e){const t={onDownloadScanStatusChanged:(t,i)=>(null==e||e(t,i),C.MR),onKsnFileReputationRequestStatusChanged:()=>{}};this.ksnFileReputation.subscribe(t)}},ut=class{constructor(e,t,i){this.userModeSettings=t.getUserModeSettingsProvider(),this.mailController=t.getMailController(),this.report=t.getThreatReportProvider(),this.threatReportService=i.get("ThreatReportService"),this.threatService=i.get("ThreatService"),this.trace=i.get("TraceService")}getMailSettings(){let e={};return 0!==this.userModeSettings.getMailSettings(e)?{}:e.value}setMailSettings(e){this.userModeSettings.setMailSettings(e)}sendReport(e,t){const i={onCompleted:(e,i)=>{t(e,i)}};this.mailController.sendMail(e,i)}sendTestEmail(e,t){const i={onCompleted:(e,i)=>{t(e,i)}};this.mailController.sendTestMail(e,i)}},ht=class{constructor(e,t,i){this.userModeSettings=t.getUserModeSettingsProvider(),this.trace=i.get("TraceService")}getUserMode(){let e={};if(0===this.userModeSettings.getUserMode(e))return e.value}setUserMode(e){this.userModeSettings.setUserMode(e)}},gt=class{constructor(e,t,i){this.userModeSettings=t.getUserModeSettingsProvider(),this.threatReportSenderProvider=t.getThreatReportSenderProvider(),this.trace=i.get("TraceService")}setThreatsReportSettings(e){let{sender:t,schedule:i}=e,s={mode:i.scheduleMode,day:i.day,hours:i.hours,minutes:i.minutes};return this.userModeSettings.setThreatsReportSettings(t,s)}getThreatsReportSettings(){const e={},t={};return this.userModeSettings.getThreatsReportSettings(e,t)===C.MR?{sender:e.value,schedule:{scheduleMode:t.value.mode,day:t.value.day,hours:t.value.hours,minutes:t.value.minutes}}:{sender:{},schedule:{}}}getReportOnDetectSetting(){const e={};return this.threatReportSenderProvider.getSettings(e)===C.MR&&e.value.reportOnDetectEnabled}setReportOnDetectSetting(e){const t=this.threatReportSenderProvider.setSettings({reportOnDetectEnabled:e});return t===C.MR?C.MR:t}},St=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.environment=t.getEnvironment()}expandEnvironmentVar(e){const t={};return this.environment.expandEnvironmentVars(e,t)===C.MR?t.value:void 0}},pt=class{constructor(e,t,i){let{shell:s}=e;this.api=s,this.trace=i.get("TraceService")}openExternal(e){return this.api.openExternal(e)}openItem(e){return this.api.openItem(e)}},mt=class{constructor(e,t,i){this.productStorage=t.getProductStorage(),this.trace=i.get("TraceService")}get(e){const t={};return this.productStorage.getValue(e,t)===C.MR?t.value:void 0}set(e,t){this.productStorage.setValue(e,t)}delete(e){this.productStorage.delete(e)}extendValue(e,t){const i=this.get(e),s=Array.isArray(t)?[]:{},r=(0,p.safeParseJson)(i)||s;return Array.isArray(r)&&Array.isArray(t)?(this.set(e,(0,p.safeJsonStringify)([...r,...t])),C.MR):Array.isArray(r)&&!Array.isArray(t)?(this.set(e,(0,p.safeJsonStringify)([...r,t])),C.MR):"object"==typeof r?(this.set(e,(0,p.safeJsonStringify)({...r,...t})),C.MR):void 0}},vt=class{constructor(e,t,i){this.environmentVarsService=i.get("EnvironmentVarsService"),this.productIdentityService=i.get("ProductIdentityService"),this.shell=i.get("ShellService"),this.updateService=i.get("UpdateService"),this.trace=i.get("TraceService"),this.ipmService=i.get("IpmService")}getGetPremiumLink(e){const t=e=>{const t=this.environmentVarsService.expandEnvironmentVar(V.Fe);return e.replace("{version}",t)},i=e=>{const t=this.environmentVarsService.expandEnvironmentVar(V.k3),i=this.ipmService.getFeatureName();return e.replace("{rebranding_code}",i||t)},s=e=>{const t=this.environmentVarsService.expandEnvironmentVar(V.Ge);return e.replace("{PpcsId}",t)},r=e=>{const t=this.productIdentityService.getMachineId();return e.replace("{PcId}",t)},a=e=>{const t=this.productIdentityService.getLocalization();return e.replace("{localization}",t.toLowerCase())};return((e,{actItem:n,type:o})=>(e=((e,t)=>e.replace("{action}",t))(e,n),e=t(e),e=i(e),e=s(e),e=r(e),e=((e,t)=>e.replace("{type}",`${t||"buy"}`))(e=a(e),o),e))(this.environmentVarsService.expandEnvironmentVar(V.I_),e)}getInterceptorLink(e){const t=b.ZD,i=this.updateService.getProductHotfix(),s=this.environmentVarsService.expandEnvironmentVar(V.Fe),r=this.environmentVarsService.expandEnvironmentVar(V.vn).toLowerCase(),a=this.productIdentityService.getLocalization().toLowerCase(),n=this.environmentVarsService.expandEnvironmentVar(V.k3);return`https://click.kaspersky.com/?hl=${a}${[b.ZD,b.kf].includes(n)?b.ZD:`&customization=${n}`}&link=${e}&syst=${t}&pid=${r}&version=${s}&hotfix=${i}`}getExtendedFeedbackLink(){const e=this.environmentVarsService.expandEnvironmentVar(V.Fe),t=this.environmentVarsService.expandEnvironmentVar(V.Ge),i=this.productIdentityService.getMachineId(),s=this.environmentVarsService.expandEnvironmentVar(V.k3),r=this.ipmService.getFeatureName()||s;return`https://redirect.kaspersky.com/sales?act-pid=${this.environmentVarsService.expandEnvironmentVar(V.vn).toLowerCase()}&act-pv=${e}&act-local=${this.productIdentityService.getLocalization().toLowerCase()}&customization=${r}&ppcs-id=${t}&pcid=${i}&act-item=kart-survey-feedback&type=feedback&rpe=1`}},wt=class{constructor(e,t,i){this.productController=t.getProductController(),this.productInfoProvider=t.getProductInfoProvider(),this.windowsInteraction=t.getWindowsInteraction(),this.trace=i.get("TraceService"),this.environmentVarsService=i.get("EnvironmentVarsService"),this.productStorageService=i.get("ProductStorageService"),this.updateService=i.get("UpdateService"),this._isFirstLaunch=!0,this._initializeFirstLaunchState(),this._getProductInfo(),this._getCurrentDirectory(),this._setSessionId()}getMachineId(){return this.environmentVarsService.expandEnvironmentVar(V.Ph)}getInstallationId(){return this.environmentVarsService.expandEnvironmentVar(V.in)}_getProductInfo(){let e={};if(0!==this.productInfoProvider.getInfo(e))return{};const{isDebugMode:t,isSpectronEnabled:i,ppcsId:s,edition:r,productLocalization:a,appId:n}=e.value;this._isDebugMode=t,this._isSpectronEnabled=i,this._ppcsId=s,this._edition=r,this._localization=a,this._appId=n}refreshPpcsIdInfo(){this._ppcsId=this.environmentVarsService.expandEnvironmentVar(V.Ge)}_getCurrentDirectory(){let e={};if(0!==this.windowsInteraction.getCurrentDirectory(e))return"";this._currentDirectory=e.value}isDebugMode(){return this._isDebugMode}getSpectronEnabled(){return this._isSpectronEnabled}getPpcsId(){return this._ppcsId}getEdition(){return this._edition}getLocalization(){return this._localization}getCurrentDirectory(){return this._currentDirectory}isCleanInstallation(){return Boolean(Number(this.environmentVarsService.expandEnvironmentVar(V.ix)))}getSystemSupportedStatus(){const e={};return this.productController.isSystemSupported(e)!==C.MR||e.value}isUndocBalloonNeeded(){const e={};return this.productController.isUndocBalloonNeeded(e)!==C.MR||e.value}setElectronVersion(e){this._electronVersion=e}getElectronVersion(){return this._electronVersion}_setSessionId(){this._sessionId=this.windowsInteraction.getSessionId()}getSessionId(){return this._sessionId}getAppId(){return this._appId}isHiberbootEnabled(){return this.windowsInteraction.isHiberbootEnabled()}_initializeFirstLaunchState(){const e=this.productStorageService.get(te)||b.ZD,t=`${this.environmentVarsService.expandEnvironmentVar(V.l4)}${this.updateService.getProductHotfix()}`;this._isFirstLaunch=e!==t}isFirstLaunch(){return this._isFirstLaunch}setIsFirstLaunch(e){this._isFirstLaunch=e}},bt=class{constructor(e,t,i){this.callbacks={},this.networkConnectionEventsSubscription=t.getNetworkConnectionEventsSubscription(),this.trace=i.get("TraceService"),this.switchCallbacks()}setOnConnectionChangedCallback(e){this.callbacks.onConnectionChanged=e}switchCallbacks(){this.networkConnectionEventsSubscription.subscribe({connectionChanged:e=>{if(!e)return;let t=e.connectionStatus;this.callbacks.onConnectionChanged&&"function"==typeof this.callbacks.onConnectionChanged&&this.callbacks.onConnectionChanged(t)}})}},ft=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.forbiddenAddresses=t.getForbiddenAddresses(),this.protectionSettings=t.getProtectionSettingsProvider()}getAllowedAddressesList(){let e={};var t;return this.forbiddenAddresses.getAddressList(e)===C.MR&&(null===(t=e.value)||void 0===t?void 0:t.allowed)||[]}getBlockedAddressesList(){let e={};var t;return this.forbiddenAddresses.getAddressList(e)===C.MR&&(null===(t=e.value)||void 0===t?void 0:t.blocked)||[]}addAllowedAddress(e){return this.forbiddenAddresses.addAllowedAddress(e)}removeAllowedAddress(e){return this.forbiddenAddresses.removeAllowedAddress(e)}removeForbiddenAddress(e){return this.forbiddenAddresses.removeForbiddenAddress(e)}getBlockingTime(){const e={};return this.protectionSettings.getBlockConnectionTimeout(e)!==C.MR?void 0:e.value}setBlockingTime(e){this.protectionSettings.setBlockConnectionTimeout(e)}},Ct=class{constructor(e,t,i){this.protectionStatus=t.getProtectionSettingsProvider(),this.trace=i.get("TraceService")}getState(e){const t=()=>{let e={};if(0===this.protectionStatus.getProtectionStatus(e))return e.value};let i=setInterval((()=>{let s=t();2!==s&&(clearInterval(i),e(s))}),1e3);return 0}},Rt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.protectionSettings=t.getProtectionSettingsProvider()}getAdwareRiskwarePornwareBlockStatus(){let e={};return this.protectionSettings.getAdwareRiskwarePornwareBlockStatus(e),e.value}setAdwareRiskwarePornwareBlockStatus(e){this.protectionSettings.setAdwareRiskwarePornwareBlockStatus(e)}},Mt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.newsProvider=t.getNewsProvider(),this.newsReceiptNotificationSubscription=t.getNewsReceiptNotificationSubscription(),this.modeService=i.get("ModeService"),this.fileService=i.get("FileService"),this.productStorage=i.get("ProductStorageService"),this.environmentVarsService=i.get("EnvironmentVarsService"),this.ipmGuiProvider=t.getIpmGuiProvider(),this.guiNotificationSubscription=t.getIpmGuiNotificationSubscription(),this._currentIntervalForIpmBalloon=24,this._cachedContent=[],this._cachedContentIds=[],this._featureName=void 0,this._initializeIntervalForIpmBalloon(),this._initializeFeatureName()}subscribe(e){const t={onNewsChanged:()=>{e()}};this.newsReceiptNotificationSubscription.subscribe(t)}getProcessedNewsInfo(){let e={};return this.newsProvider.getNews(e)!==C.MR?[]:this._processIpmContentByMetaTag(e.value.items)}_processIpmContentByMetaTag(e){if(this._checkIsContentTheSame(e))return this._cachedContent;const t=this._getUserModeAsString(),i=e.filter(((e,i)=>{const s=this.fileService.readTextFile(e.contentUri)||"";if(s.length===b.Ds)return!1;const r=this._createMetaTagTemplateByUserRole(t),a=this._createMetaTagTemplateByBalloonSchedule(),n=this._createMetaTagTemplateByCustomizationCode(),o=this._createMetaTagTemplateByBuildUpperBound(),c=this._createMetaTagTemplateByBuildLowerBound(),l=s.match(r),d=s.match(a),u=s.match(n),h=s.match(o),g=s.match(c),S=h&&this._checkProductVersionLessOrEqualThanVersionInMeta(h[b.OL]),p=g&&this._checkProductVersionMoreOrEqualThanVersionInMeta(g[b.OL]),m=(null==d?void 0:d[b.OL])||24,v=this.environmentVarsService.expandEnvironmentVar(V.k3);if(null!==l&&t!==l[b.OL]||null!==u&&v!==u[b.OL]||null!==h&&!S||null!==g&&!p)return!1;{const e=this.getCurrentIntervalForIpmBalloon();return i===b.Ds&&e!==m&&this.setCurrentIntervalForIpmBalloon(m),!0}}));return this._cacheIpmContentInfo(i),i}_checkIsContentTheSame(e){const t=this.getIdsFromIpmContent(e);return t.length===this._cachedContentIds.length&&!t.some((e=>!this._cachedContentIds.includes(e)))}_cacheIpmContentInfo(e){this._cachedContent=[...e];const t=this.getIdsFromIpmContent(e);this._cachedContentIds=[...t]}_getUserModeAsString(){return{0:"user+email",1:"user",2:"admin"}[this.modeService.getUserMode()]}_createMetaTagTemplateByUserRole(e){const t=(0,B.ZJ)(e);return new RegExp(`<meta name=["|']user-role["|'] content=(?:["|'](${t})["|'])?`)}_createMetaTagTemplateByBalloonSchedule(){return new RegExp("<meta name=[\"|']balloon-schedule[\"|'] content=[\"|'](\\d+(?:\\.\\d+)?)[\"|']")}_createMetaTagTemplateByBuildUpperBound(){return new RegExp("<meta name=[\"|']build_upperbound[\"|'] content=[\"|']((\\d+\\.\\d+.\\d+\\.\\d+)?)[\"|']")}_createMetaTagTemplateByBuildLowerBound(){return new RegExp("<meta name=[\"|']build_lowerbound[\"|'] content=[\"|']((\\d+\\.\\d+.\\d+\\.\\d+)?)[\"|']")}_createMetaTagTemplateByCustomizationCode(){return new RegExp("<meta name=[\"|']customization[\"|'] content=[\"|']((\\S+)?)[\"|']")}_checkProductVersionLessOrEqualThanVersionInMeta(e){const t=this.environmentVarsService.expandEnvironmentVar(V.Fe).split("."),i=e.split(".");if(t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return Number(t[e])<Number(i[e]);return!0}_checkProductVersionMoreOrEqualThanVersionInMeta(e){const t=this.environmentVarsService.expandEnvironmentVar(V.Fe).split("."),i=e.split(".");if(t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return Number(t[e])>Number(i[e]);return!0}_initializeIntervalForIpmBalloon(){this._currentIntervalForIpmBalloon=this.getPreviousIntervalForIpmBalloon()}getIdsFromIpmContent(e){return Array.isArray(e)?e.map((e=>e.contentId)):[]}setCurrentIntervalForIpmBalloon(e){this._currentIntervalForIpmBalloon=e}setPreviousIntervalForIpmBalloon(e){this.productStorage.set("intervalForIpmBalloon",Number(e).toExponential(11))}getCurrentIntervalForIpmBalloon(){return this.setPreviousIntervalForIpmBalloon(this._currentIntervalForIpmBalloon),this._currentIntervalForIpmBalloon}getPreviousIntervalForIpmBalloon(){const e=this.productStorage.get("intervalForIpmBalloon");return parseFloat(e)||24}restoreDefaultIpmBalloonInterval(){this._currentIntervalForIpmBalloon=24}_readFeatureNameFromIpmConfig(){var e;const t={};return this.ipmGuiProvider.getCurrentGui(t),null===(e=t.value)||void 0===e?void 0:e.name}_initializeFeatureName(){this._featureName=this._readFeatureNameFromIpmConfig()}getFeatureName(){return this._featureName}subscribeOnIpmGui(e){this.guiNotificationSubscription.subscribe(e)}getCurrentFeatureName(){return this._readFeatureNameFromIpmConfig()}};var yt=i(59431);const It=class{constructor(e,t,i){this.productIdentityService=i.get("ProductIdentityService"),this.environmentVarsService=i.get("EnvironmentVarsService"),this.trace=i.get("TraceService"),this.isEmulator=t.isEmulator,this._initializeLocalizationResources()}_initializeLocalizationResources(){const e=this.getLocalization(),t=this.productIdentityService.getEdition(),s=this.environmentVarsService.expandEnvironmentVar(V.k3),{dictionaries:r,featuresList:a}=(0,yt.getResources)({localization:e,edition:t,rebrandingCode:s});if(this.isEmulator)this.currentDictionaries=r,this.featuresList=a.featuresList;else{this.currentDictionaries=i(95718);try{const{featuresList:e}=i(99108);this.featuresList=e}catch(e){this.trace.warning("LocalizationService: _initializeLocalizationResources: no features list")}}}getLocalization(){return this.productIdentityService.getLocalization()}getLocalizationResources(){return{dictionaries:this.currentDictionaries,featuresList:this.featuresList}}},Tt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.protectionSettings=t.getProtectionSettingsProvider()}getExploitPreventionStatus(){let e={};return this.protectionSettings.getExploitPreventionStatus(e),e.value}setExploitPreventionStatus(e){this.protectionSettings.setExploitPreventionStatus(e)}getSystemProcessesMemoryProtectionStatus(){let e={};return this.protectionSettings.getSystemProcessesMemoryProtectionStatus(e),e.value}setSystemProcessesMemoryProtectionStatus(e){this.protectionSettings.setSystemProcessesMemoryProtectionStatus(e)}},Pt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.passwordManager=t.getPasswordManager()}getPasswordProtectionState(){let e={};return this.passwordManager.isPasswordSet(e),e.value}setNewPassword(e){this.passwordManager.setPassword(e)}savePassword(e){i.g._currentPassword=e}getPassword(){return i.g._currentPassword?i.g._currentPassword:""}verifyPassword(e){return 0===this.passwordManager.verifyPassword(e)}changePassword(e,t){this.passwordManager.changePassword(e,t)}setShouldBePasswordSavedPerSession(e){i.g._isShouldBePasswordSaved=e}getShouldBePasswordStoredPerSession(){return!!i.g._isShouldBePasswordSaved&&i.g._isShouldBePasswordSaved}},Et=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.agreementsManager=t.getAgreementsManager(),this.discoveryEventSubscription=t.getDiscoveryEventSubscription(),this.productStorage=i.get("ProductStorageService"),this.timeCounterService=i.get("TimeCounterService"),this.productController=t.getProductController(),this.productIdentityService=i.get("ProductIdentityService"),this.fileService=i.get("FileService")}getAgreements(){let e=[];return this.agreementsManager.getAgreements(e),e.reduce(((e,t)=>({...e,[t.id]:t})),{})}getAllAgreements(){let e=[];this.agreementsManager.getAgreements(e);let t=[];return this.agreementsManager.getAuxiliaryAgreements(t),[...e,...t]}getAcceptanceFactsWithoutRdp(){const e=[];return this.agreementsManager.getAllAcceptanceFacts(e),e.filter((e=>![Se.Z.rdp,Se.Z.rdpEtl].includes(e.agreementId)))}getAllAcceptanceFacts(){let e=[];return this.agreementsManager.getAllAcceptanceFacts(e),e}registerAcceptanceFact(e){this.agreementsManager.registerAcceptanceFact(e)}registerAcceptanceFacts(e){this.agreementsManager.registerAcceptanceFacts(e)===C.MR&&this.setAcceptedAgreementsState(Ce.Z.productAccepted)}subscribeOnDiscoveryEvent(e){this.discoveryEventSubscription.subscribe({segmentChanged:()=>{},segmentChanged2:t=>{const i=4392,s=this.productStorage.get("isFirstDiscoveryEventWasSkipped"),{newSegmentInfo:r}=t;if(r&&r.needToNotifyUser&&"function"==typeof e)if(void 0===s)this.productStorage.set("isFirstDiscoveryEventWasSkipped",!0),this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:i,listener:e,listenerLabel:"discoveryEventNotifier"});else{if(this.timeCounterService.isTimeEventExists({typeOfEvent:"interval",hoursEvent:i,eventListenerLabel:"discoveryEventNotifier"})){const e=this.timeCounterService.getDateNowAsHours();this.timeCounterService.updateTimeEventInitTime({typeOfEvent:"interval",hoursEvent:i,listenerLabel:"discoveryEventNotifier",newInitTime:e})}else this.timeCounterService.addTimeEventListener({typeOfEvent:"interval",hoursEvent:i,listener:e,listenerLabel:"discoveryEventNotifier"});e()}else void 0===s&&this.productStorage.set("isFirstDiscoveryEventWasSkipped",!0),this.timeCounterService.isTimeEventExists({typeOfEvent:"interval",hoursEvent:i,eventListenerLabel:"discoveryEventNotifier"})&&this.timeCounterService.deleteTimeEventListener({typeOfEvent:"interval",hoursEvent:i,listenerLabel:"discoveryEventNotifier"})}})}areThereNotAcceptedAgreements(){const e=this.getAgreements();return this.getAcceptanceFactsWithoutRdp().some((t=>!t.accepted&&e[t.agreementId].version===t.version))}getAcceptedAgreementsState(){const e={};return this.productController.getAcceptedAgreementsState(e)===C.MR?e.value:void 0}setAcceptedAgreementsState(e){this.productController.setAcceptedAgreementsState(e)}getNotAcceptedAgreementsText(){const e=this.getAgreements(),t=this.getActualNotAcceptedAgreementsInfo().filter((e=>e.agreementId!==Se.Z.rdp));return e&&t.length!==b.Ds?t.reduce(((t,i)=>{const s=(0,p.safeParseJson)(e[i.agreementId].tag,this.trace),r=s&&s.fileName?s.fileName:"";return{...t,[i.agreementId]:this.getAgreementTextByName(r)}}),{}):{}}getActualNotAcceptedAgreementsInfo(){const e=this.getAgreements();return this.getAcceptanceFactsWithoutRdp().filter((t=>!t.accepted&&e[t.agreementId].version===t.version))}getAgreementTextByName(e){const t=`${this.productIdentityService.getCurrentDirectory()}\\${e}`;return this.fileService.readTextFile(t)}scheduleAcceptAgreementsNotification(){this.clearAgreementBalloonTimeout(),this.timeCounterService.addTimeEventListener({typeOfEvent:"timeout",hoursEvent:3,listener:this.showAgreementBalloon.bind(this),listenerLabel:"showAgreementBalloon"})}clearAgreementBalloonTimeout(){this.timeCounterService.deleteTimeEventListener({typeOfEvent:"timeout",hoursEvent:3,listenerLabel:"showAgreementBalloon"})}showAgreementBalloon(){}},At=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.permissionsChecker=t.getPermissionsChecker(),this.featureManager=t.getFeatureManager()}checkFeatureAllowance(e){return this.permissionsChecker.isFeatureAllowed(e)===C.MR}isFeatureEnabled(e){return this.featureManager.isFeatureEnabled(e)===C.MR}},kt="interval",Dt="timeout",Ft="timeoutInitTimes",Lt="intervalInitTimes",Bt=class{constructor(e,t,i){this.productStorage=i.get("ProductStorageService"),this.traceService=i.get("TraceService"),this.productIdentityService=i.get("ProductIdentityService"),this._timeCounterInterval=this._getTimeCounterInterval(),this._triggeredTimeouts={},this._eventListeners={interval:new Map,timeout:new Map},this._initTimes={interval:{},timeout:{}},this._initializeInitTimes(),this._startListening()}addTimeEventListener({typeOfEvent:e,hoursEvent:t,listener:i,listenerLabel:s,startTimeStamp:r}){var a;if(!this._isInputParamsForAddMethodValid({typeOfEvent:e,hoursEvent:t,listener:i,listenerLabel:s,startTimeStamp:r}))return-1;const n=e===Dt?Ft:Lt,o=this.getDateNowAsHours(),c=(0,p.safeParseJson)(this.productStorage.get(n)),l=(null==c||null===(a=c[t])||void 0===a?void 0:a[s])||o;let d=new Map,u=this._initTimes[e],h=this._eventListeners[e];return h.has(t)?(d=h.get(t),d.get(s)||(d.set(s,i),u[t]={...u[t],[s]:l})):(d.set(s,i),h.set(t,d),u[t]={...u[t],[s]:l}),this.productStorage.set(n,(0,p.safeJsonStringify)(u)),0}deleteTimeEventListener({typeOfEvent:e,hoursEvent:t,listenerLabel:i}){if(!this._isInputParamsForDeleteMethodValid({typeOfEvent:e,hoursEvent:t,listenerLabel:i}))return-1;const s=e===Dt?Ft:Lt,r=(0,p.safeParseJson)(this.productStorage.get(s))||{};let a=this._initTimes[e],n=this._eventListeners[e];n.has(t)&&(n.get(t).delete(i),0===n.get(t).size&&n.delete(t)),r[t]&&(delete r[t][i],0===Object.keys(r[t]).length&&delete r[t]),a[t]&&(delete a[t][i],0===Object.keys(a[t]).length&&delete a[t]);const o=(0,p.safeJsonStringify)(r);return this.productStorage.set(s,o),0}getTimeoutInitTimes(){return this._initTimes.timeout}getIntervalInitTimes(){return this._initTimes.interval}isTimeEventExists({typeOfEvent:e,hoursEvent:t,eventListenerLabel:i}){const s=this._eventListeners[e];return(null==s?void 0:s.has(t))&&(null==s?void 0:s.get(t).has(i))}setTriggeredTimeout(e,t){this._triggeredTimeouts=this.getTriggeredTimeouts();const i=this._triggeredTimeouts[t]||[],s=Array.from(new Set([...i,e]));this._triggeredTimeouts={...this._triggeredTimeouts,[t]:[...s]},this.productStorage.set("triggeredTimeouts",(0,p.safeJsonStringify)(this._triggeredTimeouts))}getTriggeredTimeouts(){const e=this.productStorage.get("triggeredTimeouts");return(0,p.safeParseJson)(e)||{}}isTimeoutExpired(e,t){var i;const s=this.getTimeoutInitTimes(),r=this.getDateNowAsHours();return r-((null===(i=s[e])||void 0===i?void 0:i[t])||r)>e}updateTimeEventInitTime({typeOfEvent:e,hoursEvent:t,listenerLabel:i,newInitTime:s}){const r=e===Dt?Ft:Lt,a=this._initTimes[e];a[t]={...a[t],[i]:s},this.productStorage.set(r,(0,p.safeJsonStringify)(a))}getDateNowAsHours(){return Date.now()/b.Yn}_startListening(){this.listeningIntervalId=setInterval((()=>{this._triggerTimeoutListeners(),this._triggerIntervalListeners()}),this._timeCounterInterval)}_triggerTimeoutListeners(){this._eventListeners.timeout.size&&this._eventListeners.timeout.forEach(((e,t)=>{const i=this._initTimes.timeout[t];if(i)for(let[s,r]of Object.entries(i))if(t<=this.getDateNowAsHours()-r){const i=e.get(s);"function"==typeof i&&(i(),this.deleteTimeEventListener({typeOfEvent:Dt,hoursEvent:t,listenerLabel:s}),this.setTriggeredTimeout(t,s))}}))}_triggerIntervalListeners(){if(this._eventListeners.interval.size){const e=1.1,t=this.getDateNowAsHours(),i=this._timeCounterInterval/b.Yn;this._eventListeners.interval.forEach(((s,r)=>{const a=this._initTimes.interval[r];if(a)for(let[n,o]of Object.entries(a)){const a=t-o;if(r<=(i*e+(a>=0?a%r:0)||1)){const e=s.get(n);"function"==typeof e&&e()}}}))}}_initializeInitTimes(){this._initTimes.interval=(0,p.safeParseJson)(this.productStorage.get(Lt))||{},this._initTimes.timeout=(0,p.safeParseJson)(this.productStorage.get(Ft))||{}}_getTimeCounterInterval(){return this._isTestMode()?1e3:6e5}_isTestMode(){const e=this.productIdentityService.isDebugMode(),t=this.productIdentityService.getSpectronEnabled();return e||t}_isInputParamsForAddMethodValid({typeOfEvent:e,hoursEvent:t,listener:i,listenerLabel:s,startTimeStamp:r}){const a=this.getDateNowAsHours(),n=parseInt(t,10);let o=!1;return!(![Dt,kt].includes(e)||isNaN(n)||"function"!=typeof i||"string"!=typeof s||r&&"number"!=typeof r||(r&&(o=a<r+t),o))}_isInputParamsForDeleteMethodValid({typeOfEvent:e,hoursEvent:t,listenerLabel:i}){const s=parseInt(t,10);return!(![Dt,kt].includes(e)||isNaN(s)||"string"!=typeof i)}getHourEvents(e,t){const i=this.getTimeoutInitTimes(),s=this.getIntervalInitTimes();switch(e){case Dt:return Object.keys(i).filter((e=>i[e][t]));case kt:return Object.keys(s).filter((e=>s[e][t]));default:return[]}}hydrateTimeEventListener({typeOfEvent:e,listener:t,listenerLabel:i}){const s=this.getHourEvents(e,i);s.length&&s.forEach((s=>{this.addTimeEventListener({typeOfEvent:e,hoursEvent:s,listener:t,listenerLabel:i})}))}},_t=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.registrationController=t.getRegistrationController(),this.productIdentityService=i.get("ProductIdentityService"),this.featureManager=t.getFeatureManager(),this.windowsInteraction=t.getWindowsInteraction(),this.productStorage=i.get("ProductStorageService"),this._isRegistrationInProgress=!1}applyRegistrationCode(e){const t=this.registrationController.applyRegistrationCode(e);return t===C.MR&&this.productIdentityService.refreshPpcsIdInfo(),t}register(e){const t={};return this.registrationController.register(e,t)===C.MR?(this.productIdentityService.refreshPpcsIdInfo(),t.value):void 0}isUserRegistered(){const e=this.productIdentityService.getPpcsId();return Boolean(Number(e))}getFeatureFlagValue(e){const t={};return this.featureManager.getFeatureFlagValue(e,t)===C.MR?t.value:b.ZD}getRawRegistrationFormType(){const e=this.productIdentityService.getEdition()===A.H?Ie.Wx:Ie.ov,t=this.getFeatureFlagValue(e),i={};return this.windowsInteraction.getRegistrationFormType(t,i)===C.MR?i.value:Pe.cV}getRegistrationFormTypeSafe(){if(this._isRegistrationInProgress)return this.retrieveSavedFormType();{const e=this.getRawRegistrationFormType();return this.saveCurrentFormType(e),e}}deleteSavedCurrentFormType(){this.productStorage.delete(ce)}saveCurrentFormType(e){this.productStorage.set(ce,e)}retrieveSavedFormType(){const e=this.productStorage.get(ce);if(void 0===e){const e=this.getRawRegistrationFormType();return this.saveCurrentFormType(e),e}return e}setIsRegistrationInProgress(e){this._isRegistrationInProgress=e}getRegion(){const e={};return this.windowsInteraction.getRegion(e)===C.MR?e.value:b.ZD}getRegistrationSchedulerInterval(){const e={};return this.registrationController.getOpenMarketoFormSchedule(e)===C.MR?e.value/b.UO:b.uL}getRegistrationCode(){const e={};return this.registrationController.getRegistrationCode(e)===C.MR?e.value:void 0}};var Nt=new WeakMap;class xt extends Je.default{constructor(e,t,i){var s,r,a;super(e,t,i),a={writable:!0,value:[]},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(s=this,r=Nt),r.set(s,a),this.trace=i.get("TraceService"),this.productStateStatisticsService=i.get("ProductStateStatisticsService"),this.responseSender=t.getResponseSender(),this.uiRegistrator=t.getUiRegistrator(),this.callbackObject={...this.callbackObject,relaunch:e=>(this.subscribers.relaunchUi&&"function"==typeof this.subscribers.relaunchUi?this.subscribers.relaunchUi(e):this.trace.warning("KartUiRegistrationService: relaunch is not switched"),C.MR),sendRequest:(e,t)=>{switch(e){case 1:return this._handleRequest(e,t,this._tfuLoudInstallCallback);case 2:return this._handleRequest(e,t,this._tfuUpgradeRequestCallback);case 3:return this._handleRequest(e,t,this._osRestartRequestCallback);case 4:return this._handleRequest(e,t,this._appRestartRequestCallback);case 5:return this._handleRequest(e,t,this._oldVersionUninstallFailedCallback);case w:return this._handleRequest(e,t,this._showProxyBalloonCallback);case 4165273708:return this._handleRequest(e,t,this._hideProxyBalloonCallback);case 36866:return this._handleRequest(e,t,this._relaunchCallback);case 36865:return this._handleRequest(e,t,this._shutdownCallback);case 40966:return this._handleRequest(e,t,n(this,Nt));case 40967:return this._handleRequest(e,t,this._RegistrationSettingsUpdatedCallback);case 40968:return this._handleRequest(e,t,this._eolStatusCallback);case 40969:return this._handleRequest(e,t,this._migrationKesCallback)}}}}_handleRequest(e,t,i){return Array.isArray(i)?(i.forEach((i=>{if("function"!=typeof i)return C.o1;i(e,t)})),C.MR):"function"==typeof i?(i(e,t),C.MR):C.o1}sendResponse(e,t,i=b.ZD){this.responseSender.send(e,t,i)}setTfuInstallationRequestCallback(e){this._tfuLoudInstallCallback=e}setTfuUpgradeRequestCallback(e){this._tfuUpgradeRequestCallback=e}setOsRestartRequestCallback(e){this._osRestartRequestCallback=e}setAppRestartRequestCallback(e){this._appRestartRequestCallback=e}setOldVersionUninstallFailedCallback(e){this._oldVersionUninstallFailedCallback=e}setShowProxyBalloonCallback(e){this._showProxyBalloonCallback=e}setHideProxyBalloonCallback(e){this._hideProxyBalloonCallback=e}setRegistrationSettingsUpdatedCallback(e){this._RegistrationSettingsUpdatedCallback=e}setEolStatusCallback(e){this._eolStatusCallback=e}setShutdownCallback(e){this._shutdownCallback=()=>setTimeout((()=>{null==e||e()}),b.rx)}setRelaunchCallback(e){this._relaunchCallback=(t,i)=>setTimeout((()=>{null==e||e(i)}),b.rx)}unregisterUi(){this.uiRegistrator.unregisterUi()}addFeatureFlagUpdatedCallback(e){n(this,Nt).push(e)}setMigrationKesStatusCallback(e){this._migrationKesCallback=e}}const Ot=xt;var Ut=i(22271);class Wt extends Ut.default{constructor(e,t,i,s){super(e,t,i,s),this.windowsInteraction=t.getWindowsInteraction()}getMd5OfFile(e){const t={};return"function"==typeof this.windowsInteraction.getMd5OfFile&&this.windowsInteraction.getMd5OfFile(e,t),t.value}async openFilePath(e){const{filePaths:t}=await this.dialog.showOpenDialog(e,{properties:["openFile"]});return null==t?void 0:t[b.Ds]}}const zt=Wt,Gt="featuresConfiguration",Vt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.productIdentityService=i.get("ProductIdentityService"),this.fileService=i.get("FileService"),this.environmentVarsService=i.get("EnvironmentVarsService"),this._initializeGuiByExternalConfig()}_initializeGuiByExternalConfig(){this._uiCustomizationSettings=this.getSettingsFromJson(j.oM)}getSettingsFromJson(e){const t=`${this.productIdentityService.getCurrentDirectory()}\\resources\\${e}`;return this.fileService.readJSON(t)}getCustomizationParams(){return{isGetPremiumByUrl:this.isGetPremiumByUrl()}}getMarketoFormConfig(){var e;const t=this.environmentVarsService.expandEnvironmentVar(V.y5),i=this.environmentVarsService.expandEnvironmentVar(V.VS);return Object.assign(null===(e=this._uiCustomizationSettings)||void 0===e?void 0:e.userRegistrationForm,{marketoScriptUrl:t,marketoFormUrl:i})}getUiElementsConfiguration(){var e;return(null===(e=this._uiCustomizationSettings)||void 0===e?void 0:e.uiElementsConfig)||{}}isFeatureEnabledByFlagName(e){var t;if(!e)throw Error(`Invalid provided featureFlagName = ${e}. Did you forget to pass correct parameter?`);if(null===(t=this._uiCustomizationSettings)||void 0===t?void 0:t[Gt])return"boolean"!=typeof this._uiCustomizationSettings[Gt][e]||this._uiCustomizationSettings[Gt][e]}isUserRegistrationEnabled(){return this.isFeatureEnabledByFlagName("isUserRegistrationEnabled")??!0}isGetPremiumByUrl(){return this.isFeatureEnabledByFlagName("isGetPremiumByUrl")??!1}isMalwareScanEnabled(){return this.isFeatureEnabledByFlagName("isMalwareScanEnabled")??!0}isOnboardingEnabled(){return this.isFeatureEnabledByFlagName("isOnboardingEnabled")??!0}isEmailNotificationsEnabled(){return this.isFeatureEnabledByFlagName("isEmailNotificationsEnabled")??!0}isManualRegistrationOpenEnabled(){return this.isFeatureEnabledByFlagName("isManualRegistrationOpenEnabled")??!0}isDownloadsScanEnabled(){return this.isFeatureEnabledByFlagName("isDownloadsScanEnabled")??!0}getCountryCodesMapping(){var e;return null===(e=this._uiCustomizationSettings)||void 0===e?void 0:e.countryCodes}},Kt=class{constructor(e,t,i){this.dumpSender=t.getDumpSender(),this.dumpReportNotificationSubscription=t.getDumpReportNotificationSubscription(),this.trace=i.get("TraceService")}subscribe(e){this.dumpReportNotificationSubscription.subscribe(e)}sendDumpReport(e){return this.dumpSender.sendProductReport(e||b.ZD)}declineProductReport(){return this.dumpSender.declineProductReport()}sendEtlReport(){return this.dumpSender.sendEtlReport()}declineEtlReport(){return this.dumpSender.declineEtlReport()}};function Ht(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function $t(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var Zt=new WeakSet,qt=new WeakSet;function jt(){return this.permissionsCheckerService.checkFeatureAllowance(D.zp)}function Jt(e){if(this.permissionsCheckerService.checkFeatureAllowance(D.zp))return e;if(this.permissionsCheckerService.checkFeatureAllowance(D.Nb)){const{type:t,dateTime:i,formId:s,formSeqNumber:r,trigger:a}=e;return{type:t,dateTime:i,formId:s,formSeqNumber:r,trigger:a}}return{}}const Yt=class{constructor(e,t,i){Ht(this,qt),Ht(this,Zt),this.trace=i.get("TraceService"),this.productStorage=i.get("ProductStorageService"),this.productIdentityService=i.get("ProductIdentityService"),this.windowsInteraction=t.getWindowsInteraction(),this.additionalInfoStorage=t.getAdditionalInfoStorage(),this.trustedTimeProvider=t.getTrustedTimeProvider(),this.permissionsCheckerService=i.get("PermissionsCheckerService"),this.productStorageService=i.get("ProductStorageService"),this.ipmService=i.get("IpmService"),this.userRegistrationService=i.get("UserRegistrationService"),this.kesTrialEventsProvider=t.getKesTrialEventsProvider(),this._previousAliveTimestamp=void 0}getSystemUserId(){const e={};return this.windowsInteraction.getCrc32OfSystemUserId(e)===C.MR?e.value:b.ZD}getSystemUserIdIfAllowed(){return this.permissionsCheckerService.checkFeatureAllowance(D.tU)?this.getSystemUserId():b.ZD}setAdditionalInfoEvent(e,t){const i=(0,p.safeJsonStringify)(t),s=this.getSystemUserId();this.additionalInfoStorage.setAdditionalInfoEvent(s,e,i)}getExperimentUsageEvent(){const e={},t=this.getSystemUserId();return this.additionalInfoStorage.getExperimentUsage(t,e)===C.MR?(0,p.safeParseJson)(e.value):void 0}sendPreviousProductStateEvent(e=!0){const t=(0,p.safeParseJson)(this.productStorageService.get(X))||{},i=Object.keys(t);if(i.includes(Me.ppL)){const e=(0,p.safeParseJson)(this.productStorageService.get(Q));this.setRegistrationUsageEvent(e),this.productStorageService.delete(Q)}if(i.length){const s=Number(this.productStorageService.get(J)),r=new Date(s||Date.now());i.filter((t=>e?t:!R[t])).forEach((e=>{const i={...t[e],closeDateTime:r};this.setAdditionalInfoEvent(Ge,i),this.deleteCachedWindowsUiUsageEventByWinId(e)}))}else this.productStorageService.delete(X)}deleteCachedWindowsUiUsageEventByWinId(e){const t=(0,p.safeParseJson)(this.productStorageService.get(X));t&&(delete t[e],this.productStorageService.set(X,(0,p.safeJsonStringify)(t)))}getLastRegistrationEvent(){const e={},t=this.getSystemUserId();return this.additionalInfoStorage.getLastRegistrationEvent(t,e)===C.MR?(0,p.safeParseJson)(e.value):void 0}getCurrentTrustedDateTime(){const e={};return this.trustedTimeProvider.getCurrentTrustedDateTime(e),new Date(e.value).toISOString()}setAdditionalInfoExperimentEvent({event:e,experimentName:t}){if((0,p.safeJsonStringify)(e).length>b.S_)return C.o1;if(!e.timestamp)return C.o1;const i=t||this.ipmService.getFeatureName(),s=this.getExperimentUsageEvent()||{},r=(0,p.safeJsonStringify)(e).length;try{for(;JSON.stringify(s).length+r>b.S_;){const e=Object.keys(s);e.sort(((e,t)=>new Date(s[e][0].timestamp)-new Date(s[t][0].timestamp))),s[e[0]].length>b.OL?s[e[0]].shift():delete s[e[0]]}s[i]||(s[i]=[]),s[i].push(e),this.setAdditionalInfoEvent("experimentUsage",s)}catch(e){}return C.MR}setRegistrationGHEvent({data:e={},eventName:t=b.ZD,timestamp:i}){const s=$t(this,Zt,jt).call(this);e.fieldsState&&!s&&(e.fieldsState={});const r=this.userRegistrationService.getRegistrationFormTypeSafe();this.setAdditionalInfoExperimentEvent({event:{data:{formType:r,...e},event:t,timestamp:i||this.getCurrentTrustedDateTime()},experimentName:"registrations"})}getPreviousAliveTimestamp(){return this._previousAliveTimestamp}setPreviousAliveTimestamp(e){this._previousAliveTimestamp=e}addEventForKesMigration(e,t){const i=(0,p.safeJsonStringify)(t);this.kesTrialEventsProvider.addEvent(e,i)}setRegistrationUsageEvent(e){const t=$t(this,qt,Jt).call(this,e);Object.keys(t).length&&this.setAdditionalInfoEvent("registration",t)}},Xt=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.ksnTransport=t.getKsnTransport(),this.productIdentityService=i.get("ProductIdentityService"),this.permissionsCheckerService=i.get("PermissionsCheckerService"),this.environmentVarsService=i.get("EnvironmentVarsService"),this.localizationService=i.get("LocalizationService"),this.ipmService=i.get("IpmService"),this.windowsInteraction=t.getWindowsInteraction(),this._guidsByFeature={}}sendStatistics({source:e,action:t,value:i,sessionGuid:s}){var r;const a=this.productIdentityService.getPpcsId(),n=this.productIdentityService.getAppId(),o=this.environmentVarsService.expandEnvironmentVar(V.k3)||b.ZD,c=![b.ZD,b.kf].includes(o),l=this.localizationService.getLocalization(),d=c?`KART ${l}-${null==o||null===(r=o.toLowerCase)||void 0===r?void 0:r.call(o)}`:"KART GUI statistics",u=this.ipmService.getFeatureName(),[h=e,g]=e.split("_"),S={feature:u||d,eventsJson:(0,p.safeJsonStringify)({Info:{Status:"EVENTS"},Context:[{SessionId:s,Source:h,Action:t,Timestamp:Math.floor(Date.now()/1e3),Data:{item:g,value:i}}]}),ppcsId:parseInt(a,10),appId:n};this.ksnTransport.sendFeatureUsageStatistics(S)}sendStatisticsIfAllowed(e){this.permissionsCheckerService.checkFeatureAllowance(D.cH)&&this.sendStatistics(e)}getSessionGuidByBalloonId(e){const t={28:F,25:F,26:F}[e];return t?this.getGuidRelatedToFeature(t):b.ZD}getGuid(){const e={};return this.windowsInteraction.createGuid(e)===C.MR?e.value:b.ZD}getGuidRelatedToFeature(e){return this._guidsByFeature[e]||(this._guidsByFeature[e]=this.getGuid()),this._guidsByFeature[e]}resetGuidRelatedToFeature(e){this._guidsByFeature[e]=b.ZD}},Qt=class{constructor(e,t,i){this.installNotificationSubscription=t.getInstallNotificationSubscription(),this.trace=i.get("TraceService"),this.guiResourceController=t.getGuiResourcesController()}subscribe(e){this.installNotificationSubscription.subscribe(e)}refreshResourcesSymlink(){try{this.guiResourceController.refreshResourcesSymlink()}catch(e){}}},ei=class{constructor(e,t,i){this.trace=i.get("TraceService"),this._internalCache={}}setCacheValue(e,t){this._internalCache[e]=t}getCacheValue(e){return this._internalCache[e]}},ti=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.settingsController=t.getSettingsController()}getString(e){const t={};return this.settingsController.getString(e,t)===C.MR?t.value:void 0}getUint32(e){const t={};return this.settingsController.getUint32(e,t)===C.MR?t.value:void 0}getBool(e){const t={};return this.settingsController.getBool(e,t)===C.MR?t.value:void 0}},ii=class{constructor(e,t,i){this.trace=i.get("TraceService"),this.windowService=i.get("WindowService"),this.isEmulator=t.isEmulator}sendDataToSpa(e,t){var i;const s=this.windowService.getMainWindow();null==s||null===(i=s.webContents)||void 0===i||i.send(e,t)}sendDataToBalloon(e,t,i){}createSpaCallback(e){return t=>{var i,s;this.sendDataToSpa(e,t),this.isEmulator&&(null===(i=window)||void 0===i||null===(s=i.mainWindow)||void 0===s||s.webContents.send(e,t))}}};var si=i(71893);class ri extends si.default{constructor(e,t,i){super(e,t,i),this.app=e.app,this.trace=i.get("traceService"),this.initializer=t.initializer}shutdownUI(){this.app.exit()}join(){this.initializer.join()}}const ai=ri;var ni=i(83916);class oi{constructor(e,t,i){this.trace=i.get("TraceService"),this.kesMigrationManager=t.getKesMigrationManager(),this.windowsInteraction=t.getWindowsInteraction()}startForwardMigration(){return this.kesMigrationManager.startMigrationScenario(ni.Bq)===C.MR?C.MR:C.Pg}getEulaPath(){const e={};return this.kesMigrationManager.getEulaPath(e)===C.MR?e.value:void 0}restartOs(){this.kesMigrationManager.restartOs()}isMigrationEnabled(){const e={};return this.kesMigrationManager.isMigrationAllowed(e)===C.MR&&e.value}checkAdminPrivileges(){return new Promise(((e,t)=>{const i={onAdminPrivilegesCheckDone:t=>{e(t)}},s=this.windowsInteraction.checkAdminPrivileges(i);s===C.MR||t(s)}))}getServiceStatus(){const e={};return this.kesMigrationManager.getStatus(e)===C.MR?e.value:{}}clearMigrationScenario(){this.kesMigrationManager.clear()}}var ci=new WeakMap;class li extends c.BaseBL{constructor(e,t,i,a){var n,c,l,d;super(e,t,i,s,r),d={writable:!0,value:!1},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(c=this,l=ci),l.set(c,d),this.subscribeOnRendererEvents(),o(this,ci,this.serviceRegistry.kasapi.isEmulator),this.get("ProductStateStatisticsLogic").sendOldPSEventsAndScheduleAliveTimestamp(),this.globalSubscriberLogic=this.get("GlobalSubscribeLogic"),this.globalSubscriberLogic.subscribeToTracesState(),this.globalSubscriberLogic.subscribeOnProductIconClick(),this.globalSubscriberLogic.subscribeOnScreenModeChange(),this.get("ProductLaunchLogic").setElectronVersion(null===(n=a.versions)||void 0===n?void 0:n.electron),this.get("ThreatsLogic").subscribeOnThreats(),this.get("UiControllerLogic").switchUiCallbacks(a.pid),this.get("TrayLogic").createTray(),this.get("UpgradeLogic").subscribeOnTfuInstallationStatus(),this.get("AgreementsLogic").checkAgreementsAcceptance(),this.get("AgreementsLogic").subscribeOnDiscoveryEvent(),this.get("UserRegistrationLogic").scheduleUserRegistration(),this.get("UserRegistrationLogic").checkAndSubmitMarketoSilent(),this.get("DumpReportsLogic").subscribeOnDumpReportReady(),this.get("ProductLaunchLogic").scheduleTelemetrySending(),this.get("ProductLaunchLogic").sendStatisticsAboutProxy(),this.get("ThreatsLogic").scheduleActivityReport(),this.get("ThreatsLogic").subscribeOnMalwareScan(),this.get("ProductStateStatisticsLogic").resendRegistrationUsageEvent(),this.get("ThreatsLogic").subscribeOnDownloadsScan(),this.get("UserRegistrationLogic").sendIncompletePsRegistrationEvents(),this.get("UserRegistrationLogic").subscribeOnRegistrationSettingsChanges(),this.get("UserRegistrationLogic").subscribeOnRegistrationFormTypeUpdate(),this.get("ThreatsLogic").subscribeOnDownloadScanFeatureFlagChange(),this.get("MainPageLogic").subscribeBlOnEolStatusChange()}subscribeOnRendererEvents(){this.get("CommonLogic").traceInfo("BL: subscribeOnRendererEvents was called"),this.serviceRegistry.get("electron").ipcMain.on(l.Zz,(async(e,t)=>{try{await this._handleRendererRequest(t)}catch(e){this.get("CommonLogic").traceInfo(`BL: subscribeOnRendererEvents: handleRendererRequest: ERROR=${e}`),console.error(e)}}))}async _handleRendererRequest(e){const t=await this.get(e.logicName)[e.methodName](e.data),i=`${e.logicName}:${e.methodName}:${e.requestId}`;var s,r;"mainWindow"===e.rendererName?(this.serviceRegistry.get("IpcService").sendDataToSpa(i,t),n(this,ci)&&(null===(s=window)||void 0===s||null===(r=s.mainWindow)||void 0===r||r.webContents.send(i,t))):this.get("CommonLogic").traceInfo(`BL: _handleRendererRequest: unknown rendererName=${e.rendererName}`)}}},37515:(e,t,i)=>{i.d(t,{Z:()=>s});const s={notAccepted:0,installerAccepted:1,productAccepted:2}},66125:(e,t,i)=>{i.d(t,{Fe:()=>a,Ge:()=>c,I_:()=>o,Ph:()=>d,VS:()=>h,bm:()=>m,in:()=>l,ix:()=>s,k3:()=>n,l4:()=>r,le:()=>S,vX:()=>p,vn:()=>u,y5:()=>g});const s="%IsCleanInstallation%",r="%ProductVersion%",a="%MarketingProductVersion%",n="%RebrandingCode%",o="%PremiumLink%",c="%PpcsId%",l="%ProductInstallationId%",d="%MachineId%",u="%ProductType%",h="%MarketoFormUrl%",g="%MarketoScriptUrl%",S="%Eol%",p="%Localization%",m="%Edition%"},29411:(e,t,i)=>{i.d(t,{EK:()=>n,W5:()=>s,ZP:()=>a,sy:()=>r});const s=3,r=4,a=5,n=6},71856:(e,t,i)=>{i.d(t,{F7:()=>s,Wx:()=>r,ov:()=>a});const s="kart.downloadScan",r="kart.userRegistrationGH.Business",a="kart.userRegistrationGH.Home"},79158:(e,t,i)=>{i.d(t,{N1:()=>r,Nb:()=>S,Q7:()=>n,RW:()=>d,S0:()=>u,SZ:()=>g,Xz:()=>h,cH:()=>o,eX:()=>s,ow:()=>c,qK:()=>a,tU:()=>l,zp:()=>p});const s=2315481877,r=1442408112,a=1540376503,n=2053105129,o=1145656411,c=3749922893,l=1572049213,d=2282992486,u=2564031954,h=3139375325,g=1163956862,S=688673833,p=1302738846},524:(e,t,i)=>{i.d(t,{B2:()=>p,C1:()=>u,CS:()=>d,KS:()=>l,Kn:()=>a,S5:()=>h,YM:()=>S,_t:()=>g,iJ:()=>n,oM:()=>r,uR:()=>s,yM:()=>c,zx:()=>o});const s="default_app.asar",r="gui_configuration.json",a="license.txt",n="privacy_policy.txt",o="supplemental.txt",c="marketing.txt",l="RDP_1.txt",d="rdp_etl_1",u="beta-testing.html",h="main-banner-sv.html",g="text-substitution.html",S="update.html",p="hidden-window-with-marketo-form.html"},83916:(e,t,i)=>{i.d(t,{Bq:()=>r,HG:()=>a,Ri:()=>s});const s=0,r="ForwardMigration",a="BackwardMigration"},54363:(e,t,i)=>{i.d(t,{w:()=>s});const s={WINDOW:0,FULLSCREEN:1}},48510:(e,t,i)=>{i.r(t);var s={};i.r(s),i.d(s,{existsSync:()=>q,readFileSync:()=>Z,writeFile:()=>j});var r=i(40529),a=i(83498),n=i(7940),o=i(15606),c=i(72929),l=i(11880);const d={...c.default,ipcRenderer:{on:(e,t)=>{window.addEventListener(e,(e=>t(e,e.detail)))},once:(e,t)=>{const i=s=>{t(s,s.detail),window.removeEventListener(e,i)};window.addEventListener(e,i)},send:(e,t)=>{const i=new CustomEvent(e,{detail:t});dispatchEvent(i)},sendTo:()=>{}},ipcMain:{on:(e,t)=>{window.addEventListener(e,(e=>{e.type===l.Zz&&t(e,e.detail)}))},once:()=>{}},dialog:{showOpenDialog:()=>new Promise((e=>{e({filePaths:["C:\\windows\\fake-file-path\\emulated.exe"]})}))},net:{request:()=>({on:(e,t)=>{window.addEventListener(e,(e=>{t(e.detail)}))},setHeader:()=>{},abort:()=>{},end:()=>{}})},BrowserWindow:class{constructor(){this.webContents={send(e,t){const i=new CustomEvent(e,{detail:t});dispatchEvent(i)},on(){}},this.id=1}loadURL(e){this.url=e}on(e,t){window.addEventListener(e,(e=>t(e,e.detail)))}once(){}show(){console.log("BrowserWindow Emulator: show window with url "+this.url)}close(){}focus(){}isVisible(){return!0}isMinimized(){return!1}setEnabled(e){console.log(`window isEnabled=${e}`)}setAlwaysOnTop(){console.log("setAlwaysOnTop was called")}}};var u=i(82038),h=i(41659),g=i(91525),S=i(66125),p=i(29411),m=i(58577),v=i(71856),w=i(73557),b=i(83),f=i(89342),C=i(64030),R=i(54363),M=i(62760),y=i(524),I=i(83916);let T=I.HG,P=I.Ri;const E={clear:()=>(console.log("KesMigrationManager: clear was called"),T=n.ZD,P=n.ZD,C.MR),isMigrationAllowed:e=>(e.value=!0,C.MR),getEulaPath:e=>(e.value=y.Kn,C.MR),getStatus:e=>(e.value={scenario:T,result:P},C.MR),restartOs:()=>(console.log("KesMigrationManager: restartOs was called"),C.MR),startMigrationScenario:e=>(console.log(`KesMigrationManager: startMigrationScenario was called with scenario: ${e}`),C.MR),startForwardMigration:()=>{},startBackwardMigration:()=>(console.log("KesMigrationManager: startBackwardMigration was called"),C.MR),getRedirectorLinkTemplate:e=>(e.value="https://redirect.kaspersky.com/sales?act-pid=kar&act-pv={version}&act-local={localization}&ppcs-id={PpcsId}&pcid={PcId}&customization=default&act-item={action}&type={type}&rpe=1",C.MR),isKesPasswordSet:e=>(e.value=!0,C.MR),setKesCredentials:(e,t)=>console.log(`User input: login=${e} password=${t}`),uninstallKesManually:()=>(console.log("uninstallKesManually was called successfully"),C.MR)},A={expandEnvironmentVars:(e,t)=>(t.value=window.kartMockData.emulationData.environmentVars[e],C.MR)};var k=i(59890),D=i(74175),F=i(37515);const L={[m.H]:1880,[m.L]:2196};var B=i(79158),_=i(41410),N=i(19652),x=i(38923);const O=JSON.parse('{"uiElementsConfig":{"upgradeProtectionPage":{"isFirstTabActive":true}},"featuresConfiguration":{"isEmailNotificationsEnabled":true,"isUserRegistrationEnabled":true,"isMalwareScanEnabled":true,"isGetPremiumByUrl":false,"isOnboardingEnabled":true,"isManualRegistrationOpenEnabled":true,"isDownloadsScanEnabled":true},"userRegistrationForm":{"munchkinId":"802-IJN-240","formId":12829,"fieldIds":{"formIdFieldId":"formid","countryFieldId":"Country","companyFieldId":"Company","stateFieldId":"State","emailFieldId":"Email","firstNameFieldId":"FirstName","lastNameFieldId":"LastName","subscriptionSingleOptInFieldId":"subscriptionSingleOptIn","numberOfPCFieldId":"Nodes__c","numberOfEmployeesFieldId":"NumberOfEmployees","phoneFieldId":"Phone","campaignMedium":"Campaign_Medium","campaignSource":"Campaign_Source","subscriptionTextVersion":"subscriptionTextVersion","munchkinFieldId":"munchkinId","authCode":"authCode","kartCustomerType":"kartCustomerType","ppcsId":"ppcsId"}},"countryCodes":{"ABW":"Aruba","AFG":"Afghanistan","AGO":"Angola","AIA":"Anguilla","ALA":"land Islands","ALB":"Albania","AND":"Andorra","ARE":"United Arab Emirates","ARG":"Argentina","ARM":"Armenia","ASM":"American Samoa","ATA":"Antarctica","ATF":"French Southern Territories","ATG":"Antigua and Barbuda","AUS":"Australia","AUT":"Austria","AZE":"Azerbaijan","BDI":"Burundi","BEL":"Belgium","BEN":"Benin","BES":"Bonaire, Sint Eustatius and Saba","BFA":"Burkina Faso","BGD":"Bangladesh","BGR":"Bulgaria","BHR":"Bahrain","BHS":"Bahamas","BIH":"Bosnia and Herzegovina","BLM":"Saint Barthlemy","BLR":"Belarus","BLZ":"Belize","BMU":"Bermuda","BOL":"Bolivia, Plurinational State of","BRA":"Brazil","BRB":"Barbados","BRN":"Brunei Darussalam","BTN":"Bhutan","BVT":"Bouvet Island","BWA":"Botswana","CAF":"Central African Republic","CAN":"Canada","CCK":"Cocos (Keeling) Islands","CHE":"Switzerland","CHL":"Chile","CHN":"China","CIV":"Cte d\'Ivoire","CMR":"Cameroon","COD":"Congo, the Democratic Republic of the","COG":"Congo","COK":"Cook Islands","COL":"Colombia","COM":"Comoros","CPV":"Cabo Verde","CRI":"Costa Rica","CUB":"Cuba","CUW":"Curaao","CXR":"Christmas Island","CYM":"Cayman Islands","CYP":"Cyprus","CZE":"Czechia","DEU":"Germany","DJI":"Djibouti","DMA":"Dominica","DNK":"Denmark","DOM":"Dominican Republic","DZA":"Algeria","ECU":"Ecuador","EGY":"Egypt","ERI":"Eritrea","ESH":"Western Sahara","ESP":"Spain","EST":"Estonia","ETH":"Ethiopia","FIN":"Finland","FJI":"Fiji","FLK":"Falkland Islands (Malvinas)","FRA":"France","FRO":"Faroe Islands","FSM":"Micronesia, Federated States of","GAB":"Gabon","GBR":"United Kingdom","GEO":"Georgia","GGY":"Guernsey","GHA":"Ghana","GIB":"Gibraltar","GIN":"Guinea","GLP":"Guadeloupe","GMB":"Gambia","GNB":"Guinea-Bissau","GNQ":"Equatorial Guinea","GRC":"Greece","GRD":"Grenada","GRL":"Greenland","GTM":"Guatemala","GUF":"French Guiana","GUM":"Guam","GUY":"Guyana","HKG":"Hong Kong","HMD":"Heard Island and McDonald Islands","HND":"Honduras","HRV":"Croatia","HTI":"Haiti","HUN":"Hungary","IDN":"Indonesia","IMN":"Isle of Man","IND":"India","IOT":"British Indian Ocean Territory","IRL":"Ireland","IRN":"Iran, Islamic Republic of","IRQ":"Iraq","ISL":"Iceland","ISR":"Israel","ITA":"Italy","JAM":"Jamaica","JEY":"Jersey","JOR":"Jordan","JPN":"Japan","KAZ":"Kazakhstan","KEN":"Kenya","KGZ":"Kyrgyzstan","KHM":"Cambodia","KIR":"Kiribati","KNA":"Saint Kitts and Nevis","KOR":"Korea, Republic of","KWT":"Kuwait","LAO":"Lao People\'s Democratic Republic","LBN":"Lebanon","LBR":"Liberia","LBY":"Libya","LCA":"Saint Lucia","LIE":"Liechtenstein","LKA":"Sri Lanka","LSO":"Lesotho","LTU":"Lithuania","LUX":"Luxembourg","LVA":"Latvia","MAC":"Macao","MAF":"Saint Martin (French part)","MAR":"Morocco","MCO":"Monaco","MDA":"Moldova, Republic of","MDG":"Madagascar","MDV":"Maldives","MEX":"Mexico","MHL":"Marshall Islands","MKD":"Macedonia, the former Yugoslav Republic of","MLI":"Mali","MLT":"Malta","MMR":"Myanmar","MNE":"Montenegro","MNG":"Mongolia","MNP":"Northern Mariana Islands","MOZ":"Mozambique","MRT":"Mauritania","MSR":"Montserrat","MTQ":"Martinique","MUS":"Mauritius","MWI":"Malawi","MYS":"Malaysia","MYT":"Mayotte","NAM":"Namibia","NCL":"New Caledonia","NER":"Niger","NFK":"Norfolk Island","NGA":"Nigeria","NIC":"Nicaragua","NIU":"Niue","NLD":"Netherlands","NOR":"Norway","NPL":"Nepal","NRU":"Nauru","NZL":"New Zealand","OMN":"Oman","PAK":"Pakistan","PAN":"Panama","PCN":"Pitcairn","PER":"Peru","PHL":"Philippines","PLW":"Palau","PNG":"Papua New Guinea","POL":"Poland","PRI":"Puerto Rico","PRK":"Korea, Democratic People\'s Republic of","PRT":"Portugal","PRY":"Paraguay","PSE":"Palestine, State of","PYF":"French Polynesia","QAT":"Qatar","REU":"Runion","ROU":"Romania","RUS":"Russia","RWA":"Rwanda","SAU":"Saudi Arabia","SDN":"Sudan","SEN":"Senegal","SGP":"Singapore","SGS":"South Georgia and the South Sandwich Islands","SHN":"Saint Helena, Ascension and Tristan da Cunha","SJM":"Svalbard and Jan Mayen","SLB":"Solomon Islands","SLE":"Sierra Leone","SLV":"El Salvador","SMR":"San Marino","SOM":"Somalia","SPM":"Saint Pierre and Miquelon","SRB":"Serbia","SSD":"South Sudan","STP":"Sao Tome and Principe","SUR":"Suriname","SVK":"Slovakia","SVN":"Slovenia","SWE":"Sweden","SWZ":"Swaziland","SXM":"Sint Maarten (Dutch part)","SYC":"Seychelles","SYR":"Syrian Arab Republic","TCA":"Turks and Caicos Islands","TCD":"Chad","TGO":"Togo","THA":"Thailand","TJK":"Tajikistan","TKL":"Tokelau","TKM":"Turkmenistan","TLS":"Timor-Leste","TON":"Tonga","TTO":"Trinidad and Tobago","TUN":"Tunisia","TUR":"Turkey","TUV":"Tuvalu","TWN":"Taiwan, Province of China","TZA":"Tanzania, United Republic of","UGA":"Uganda","UKR":"Ukraine","UMI":"United States Minor Outlying Islands","URY":"Uruguay","USA":"United States of America","UZB":"Uzbekistan","VAT":"Holy See","VCT":"Saint Vincent and the Grenadines","VEN":"Venezuela, Bolivarian Republic of","VGB":"Virgin Islands, British","VIR":"Virgin Islands, U.S.","VNM":"Viet Nam","VUT":"Vanuatu","WLF":"Wallis and Futuna","WSM":"Samoa","YEM":"Yemen","ZAF":"South Africa","ZMB":"Zambia","ZWE":"Zimbabwe"}}'),U={fullName:"C:\\Users\\Downloads\\Awesome Application.exe",signature:"Awesome inc.",status:g.P6},W={...U,status:g.KM};var z=i(52394),G=i(50868);const V=new Array(1e3).fill(n.OL).map(((e,t)=>{const i=t+n.OL;return t%2===n.Ds?{action:M.jl,isRemote:!1,eventType:z.FT,objectName:`${i}C:\\object name`,objectPath:`${i}C:\\object path`,objectType:G.OM,threatName:`${i}PDM:trojan.Win32.Bazon.a.Bazon.b.Bazon.c.Bazon.d.Bazon.e.Bazon.f.Bazon.g.Bazon.d.Bazon.e.Bazon.f.Bazon.ggg`,threatPath:`${i}C:\\users\\path\\to\\treat\\app.exe_1`,threatType:p.W5,time:new Date(Date.now()-Math.floor(1e6*Math.random())),result:n.Ds}:t%3===n.Ds?{action:M.jl,isRemote:!1,eventType:z.FT,objectName:`${i}C:\\object name`,objectPath:`${i}C:\\object path`,objectType:G.IV,threatName:`${i}PDM:trojan.Win32.Bazon.a.Bazon.b.Bazon.c.Bazon.d.Bazon.e.Bazon.f.Bazon.g.Bazon.d.Bazon.e.Bazon.f.Bazon.ggg`,threatPath:`${i}C:\\users\\path\\to\\treat\\app.exe_1`,threatType:p.W5,time:new Date(Date.now()-Math.floor(1e6*Math.random())),result:n.Ds}:t%5===n.Ds?{action:M.SL,isRemote:!1,eventType:z.lB,objectName:`${i}C:\\object name`,objectPath:`${i}C:\\object path`,objectType:-n.OL,threatName:`${i}Exploit:in.your.process`,threatPath:`${i}C:\\users\\path\\to\\treat\\app.exe_1`,threatType:p.W5,time:new Date(Date.now()-Math.floor(1e6*Math.random())),result:n.Ds}:t%7===n.Ds?{action:M.SL,isRemote:!0,eventType:z.Po,objectName:`${i}C:\\object name`,objectPath:`${i}C:\\object path`,objectType:G.OM,threatName:`${i}Remote Machine`,threatPath:`${i}_111.111.222.222`,threatType:p.W5,time:new Date(Date.now()-Math.floor(1e6*Math.random())),result:n.Ds}:{action:M.SL,isRemote:!1,eventType:z.Po,objectName:`${i}C:\\object name`,objectPath:`${i}C:\\object path`,objectType:G.OM,threatName:`${i}PDM:trojan.Win32.Bazon.a.Bazon.b.Bazon.c.Bazon.d.Bazon.e.Bazon.f.Bazon.g.Bazon.d.Bazon.e.Bazon.f.Bazon.ggg`,threatPath:`${i}C:\\users\\path\\to\\treat\\app.exe_1`,threatType:p.W5,time:new Date(Date.now()-Math.floor(1e6*Math.random())),result:n.Ds}})),K={nextScanTime:new Date,lastScanTime:new Date("Jan 01, 1601"),status:b.Gc,timeToScan:0,malwareList:[{objectPath:"C:\\Windows\\some\\folder\\path\\some\\folder\\path\\some\\folder\\path\\some\\folder\\path\\some\\folder\\path\\some\\folder\\path",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path1",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path2",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path3",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path4",detectionDate:new Date},{objectPath:"C:\\User\\some\\folder\\path5",detectionDate:new Date}],statistic:{totalFiles:304,scannedFiles:n.Ds,totalKsnFailedScanFiles:n.Ds,statisticsByFolder:[{folder:"%WinDir%",folderName:"Windows",state:g.OK,scannedFiles:55,malwareDetected:n.Ds,ksnFailedScanFiles:1,otherFailedScanFiles:23,extStatistics:new Array(Math.ceil(10*Math.random())).fill(1).map(((e,t)=>({ext:`ext${t}`,totalScannedFiles:Math.ceil(1e3*Math.random())})))},{folder:"C:\\StartUp",folderName:"Startup",state:g.aC,scannedFiles:55,malwareDetected:1,ksnFailedScanFiles:12,otherFailedScanFiles:23,extStatistics:new Array(Math.ceil(50*Math.random())).fill(1).map(((e,t)=>({ext:`ext${t}`,totalScannedFiles:Math.ceil(1e3*Math.random())})))},{folder:"C:\\Users",folderName:"Users",state:g.UO,scannedFiles:55,malwareDetected:n.Ds,ksnFailedScanFiles:3,otherFailedScanFiles:23,extStatistics:[]}]},internetConnection:!0,trustedKL:"trustedKL",trustedMS:"trustedMS",cashCount:n.OL,startTime:new Date,scanDuration:n.KR};class H extends u.default{constructor(){let e=(0,k.kp)("edition"),t=(0,k.kp)("localization"),i=(0,k.kp)("rebrandingCode");e||(console.log(`%cInvalid param edition=${e}! Fallback param edition=${m.H} is used`,"background-color: yellow; color: #333;"),e=m.H),t||(console.log(`%cInvalid param localization=${t}! Fallback param localization=${w.yy} is used`,"background-color: yellow; color: #333;"),t=w.yy),i||(console.log(`%cThere is no rebrandingCode parameter(optional). Fallback param rebrandingCode=${n.kf} is used`,"background-color: yellow; color: #333;"),i=n.kf),window.kartMockData=(({edition:e,localization:t,rebrandingCode:i})=>{var s;if(!e||!t)throw new Error(`Wrong input params: edition must be of type String got ${typeof e} and localization must be of type String got ${typeof t}`);const r=(({edition:e,localization:t,rebrandingCode:i})=>{if(!e||!t)throw new Error(`Wrong input params: edition must be of type String got ${typeof e} and localization must be of type String got ${typeof t}`);const s={"en-US-business":O},r=[n.ZD,n.kf].includes(i)?n.ZD:`-${x.Z[i]}`,a=`${t}-${e.toLowerCase()}${r}`;return JSON.stringify(s[a])})({edition:e,localization:t,rebrandingCode:i});return{mockFilesContent:{[y.oM]:r,[y.Kn]:y.Kn,[y.iJ]:y.iJ,[y.zx]:y.zx,[y.yM]:y.yM,[y.KS]:y.KS,[y.CS]:y.CS,[y.C1]:y.C1,[y.S5]:y.S5,[y._t]:y._t,[y.YM]:y.YM},emulationData:{blocked:["C:\\windows\\app_3.exe","C:\\windows\\app_4.exe","C:\\test\\Long Path1\\Long Path2\\Long Path3\\Long Path4\\Long Path5\\Long Path6\\Long Path7\\Long Path8\\Long Path9\\Long Path10\\Long Path11\\Long Path12\\Long Path13\\New folder\\New folder\\New folder\\New folder\\New folder\\New folder\\New folder\\sw_test","C:\\windows\\path\\path\\path\\path\\path\\path\\path\\path\\path\\path\\path\\path\\app_5.exe","C:\\windows\\app_6.exe"],allowed:["C:\\windows\\app_1.exe","C:\\windows\\app_2.exe","C:\\windows\\app_7.exe"],threats:V,threatsReportSize:V.length,threatsAndRollbackCounts:{localThreatCount:3,localRollbackCount:5,remoteThreatCount:6,remoteRollbackCount:7},traces:{enabled:!1,level:500,levels:{TLNON:0,TLALW:100,TLCRT:200,TLERR:300,TLDNG:400,TLWRN:500,TLIMP:600,TLINF:700,TLDBG:800,TLPRN:900}},mailSettings:{connectionSecurity:1,destinationEmailAddress:"destination.email@address.com",needAuthentication:!0,serverAddress:"server.address.com",serverPort:3168,userEmailAddress:"user.email@address.com",login:"login",password:"123"},mode:N.Ye,sender:{position:"Position field",userName:"userName"},schedule:{day:2,hours:22,minutes:15,mode:1},reportOnDetectEnabled:!1,proxySettings:{mode:_.vP,cacheClientSettingsTimeout:6e4,cacheErrorResolvingTimeout:3e5,cacheTimeout:3e5,useIESetting:!0,useProxyForLocalAddresses:!1,defaultProxy:{proxyAuth:{encryptedUserName:["John"],encryptedPassword:["123"],authType:0},proxyHost:"hqproxy.avp.ru",proxyPort:8080,proxyType:1}},storageValues:{isFirstLaunch:!0},environmentVars:{[S.Fe]:"6.4.0.1234",[S.I_]:`https://redirect.kaspersky.com/sales?act-pid=${e===m.H?"kar":"karh"}&act-pv={version}&act-local={localization}&ppcs-id={PpcsId}&pcid={PcId}&customization={rebranding_code}&act-item={action}&type={type}&rpe=1`,[S.k3]:i,[S.ix]:!0,[S.in]:"AB3B22D4-366E-2246-8E83-51CF849E4A52",[S.Ph]:"F2F20D6F-B0C9-4FF2-B03B-34DF7DE99CD4",[S.vn]:e.toLowerCase()===m.H.toLowerCase()?n.q_:n.Jo,[S.y5]:"https://app-sj06.marketo.com/js/forms2/js/forms2.min.js",[S.VS]:"https://app-sj06.marketo.com",[S.le]:0,[S.vX]:t,[S.bm]:e,[S.l4]:"6.4.0.1234",[S.Ge]:0},settingsVars:{},timeoutInMsec:3e6,forbiddenAddresses:[{address:"10.10.10.10",time:1540801576374,timeOut:594e4},{address:"10.10.10.11",time:1540801576374,timeOut:594e4},{address:"10.10.10.12",time:1540801576374,timeOut:594e4},{address:"10.10.10.13",time:1540801576374,timeOut:594e4}],allowedAddresses:["10.10.10.20","10.10.10.21","10.10.10.22"],adwareRiskwarePornwareStatus:!0,localizationList:"ru-RU;ar;cs;de;en;es-MX;fa;fr;hi;id;it;ko;nl;pl;pt-BR;ru;tr;vi;zh-Hans;zh-Hant",exploitPreventionStatus:!1,systemProcessesMemoryProtectionStatus:!1,passwordProtectionState:!1,featureAllowances:{[B.eX]:n.Ds,[B.qK]:n.Ds,[B.N1]:n.Ds,[B.Q7]:n.Ds,[B.cH]:n.Ds,[B.ow]:n.Ds,[B.RW]:n.Ds,[B.S0]:n.Ds,[B.Xz]:n.Ds,[B.SZ]:n.Ds,[B.Nb]:n.Ds,[B.zp]:n.Ds},featureFlags:{[v.F7]:n.Ds},password:"1",agreementState:F.Z.notAccepted,agreementsAcceptance:[{agreementId:D.Z.eula,version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/EULA/en/license.txt@6749fed59744a4b477f364d799ad4b84686548e",factModiticationDate:0,accepted:!0},{agreementId:D.Z.privacyPolicy,version:"product/legal/common/pp/1.0/en/privacy_policy.txt@93e26e7686f52ef2c03d8ef3b47bb40b85342929",factModiticationDate:"Mon Mar 30 2020 19:26:31 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!1},{agreementId:D.Z.marketing,factModiticationDate:"Mon Mar 30 2020 19:26:31 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!0,version:"product/legal/EULA/Common_EULA_1.6/Consumer/GDPR/Kaspersky_AntiRansom/3.1/Marketing/en/marketing.txt"},{agreementId:D.Z.supplemental,factModiticationDate:"Mon Jan 01 1601 03:00:00 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!0,version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental_2.txt"},{agreementId:D.Z.supplemental,factModiticationDate:"Mon Jan 01 1601 03:00:00 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!0,version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental.txt"},{agreementId:D.Z.rdp,factModiticationDate:"Mon Jan 01 1601 03:00:00 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!0,version:"RH#1"},{agreementId:D.Z.rdpEtl,factModiticationDate:"Mon Jan 01 1601 03:00:00 GMT+0300 (Russia TZ 2 Standard Time)",accepted:!0,version:"RH#1"}],agreements:[{id:D.Z.eula,version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/EULA/en/license.txt@6749fed59744a4b477f364d799ad4b84686548e",tag:'{ "order":0, "fileName":"license.txt", "git":"product/legal/EULA/Common_EULA_1.6/GDPR/Consumer/Kaspersky_AntiRansom/3.1/EULA/en/license.txt", "revision":1, "edition":"Home" }'},{id:D.Z.privacyPolicy,version:"product/legal/common/pp/1.0/en/privacy_policy.txt@93e26e7686f52ef2c03d8ef3b47bb40b85342929",tag:'{ "order":2, "fileName":"privacy_policy.txt", "git":"product/legal/common/pp/1.0/en/privacy_policy.txt", "revision":1, "edition":"Home" }'},{id:D.Z.supplemental,tag:'{ "order":1, "fileName":"supplemental.txt", "git":"product/legal/EULA/Common_EULA_1.6/Consumer/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental.txt", "revision":1, "edition":"Home" }',version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental_2.txt"},{id:D.Z.marketing,version:"product/legal/EULA/Common_EULA_1.6/Consumer/GDPR/Kaspersky_AntiRansom/3.1/Marketing/en/marketing.txt",tag:'{ "order":3, "fileName":"marketing.txt", "git":"product/legal/EULA/Common_EULA_1.6/Consumer/GDPR/Kaspersky_AntiRansom/3.1/Marketing/en/marketing.txt", "revision":1, "edition":"Home" }'},{id:D.Z.rdp,version:"RH#1",tag:'{ "order":4, "fileName":"RDP_1.txt", "git":"RH#1", "revision":1, "edition":"Business" }'},{id:D.Z.rdpEtl,version:"RH#1",tag:'{ "order":4, "fileName":"rdp_etl_1.txt", "git":"RH#1", "revision":1, "edition":"Business" }'}],auxiliaryAgreements:[{id:D.Z.supplemental,version:"product/legal/EULA/Common_EULA_1.6/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental.txt",tag:'{ "order":1, "fileName":"supplemental.txt", "git":"product/legal/EULA/Common_EULA_1.6/Corporate/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental.txt", "revision":1, "edition":"Business" }'}],agreementsText:{eulaId:"THIS IS TEXT OF EULA AGREEMENT",privacyPolicyId:"THIS IS TEXT OF PRIVACY POLICY AGREEMENT",supplementalId:"THIS IS TEXT OF SUPPLEMENTAL AGREEMENT",rdpId:"THIS IS TEXT OF RDP AGREEMENT",rdpEtlId:"THIS IS TEXT OF RDP AGREEMENT"},ipmNews:[{title:"Old known news",contentUri:"./ipm-mock-content/beta-testing/beta-testing.html",contentId:"123123123"},{title:"Old known news 2",contentUri:"./ipm-mock-content/main-banner-sv/index.html",contentId:"344564564"}],freshIpmNews:[{title:"fresh news",contentUri:"./ipm-mock-content/text-substitution/index.html",contentId:"3453226262"},{title:"fresh news 1",contentUri:"./ipm-mock-content/beta-testing/beta-testing.html",contentId:"56767216"},{title:"fresh news 2",contentUri:"./ipm-mock-content/main-banner-sv/index.html",contentId:"567672162"},{title:"fresh news 3",contentUri:"./ipm-mock-content/update/update.html",contentId:"567672163"}],ppcsId:(null===(s=JSON.parse(sessionStorage.getItem("storageValues")))||void 0===s?void 0:s.ppcsId)||n.Ds,productLocalization:t,edition:e,isDebugMode:!0,isSpectronEnabled:!0,appId:L[e],guiIpmInfo:{id:"emulatedID",name:"emulatedFeatureName",enabled:"emulatedEnabled",path:"emulatedPath",minVersion:"emulatedMinVersion",maxVersion:"emulatedMaxVersion"},dumpReports:["C:\\DumpLocation\\First","C:\\DumpLocation\\Second","C:\\DumpLocation\\Third"],activityReport:{malwareDetects:Math.floor(Math.random()*n.KR),malwareScannedFiles:Math.floor(Math.random()*n.KR),rolledBackFiles:Math.floor(Math.random()*n.KR),blockedApps:Math.floor(Math.random()*n.KR),blockedMachines:Math.floor(Math.random()*n.KR),remoteThreats:Math.floor(Math.random()*n.KR),processes:Math.floor(Math.random()*n.KR)},safeFile:W,dangerousFile:U,userRegion:Math.random()<=.5?"RUS":"MEX"}}})({localization:t,edition:e,rebrandingCode:i}),sessionStorage.getItem("storageValues")&&(window.kartMockData.emulationData.storageValues=JSON.parse(sessionStorage.getItem("storageValues"))),super(window.kartMockData),this.isEmulator=!0}getProductController(){return{empty:()=>0,getAcceptedAgreementsState:e=>(e.value=this.emulationData.agreementState,0),setAcceptedAgreementsState:e=>(this.emulationData.agreementState=e,0),isSystemSupported:()=>!1,isUndocBalloonNeeded:()=>!0}}getEnvironment(){return A}getSettingsController(){return{getString:(e,t)=>(t.value=this.emulationData.settingsVars[e],C.MR),getUint32:(e,t)=>(t.value=this.emulationData.settingsVars[e],C.MR),getBool:(e,t)=>(t.value=this.emulationData.settingsVars[e],C.MR)}}getForbiddenApps(){return{removeForbiddenApp:e=>(this.emulationData.blocked=(0,h.d1t)((0,h.fS0)(e),this.emulationData.blocked),C.MR),getAppList:e=>(e.value={allowed:this.emulationData.allowed,blocked:this.emulationData.blocked},C.MR),addAllowedApp:e=>(this.emulationData.allowed.push(e),C.MR),removeAllowedApp:e=>(this.emulationData.allowed=(0,h.d1t)((0,h.fS0)(e),this.emulationData.allowed),C.MR),addForbiddenApp:e=>(this.emulationData.blocked.push(e),C.MR)}}getThreatReportProvider(){return{getReport:(e,t,i)=>(console.log("kasapi getReport",e,t),i.value={events:this.emulationData.threats.slice(e,e+t)},C.MR),getReportSize:e=>(e.value=this.emulationData.threatsReportSize,C.MR),clearReport:()=>(this.emulationData.threats=[],this.emulationData.threatsReportSize=n.Ds,C.MR),addEventWithoutNotification:e=>(console.log(`addEventWithoutNotification: event ${e}`),C.MR)}}getActivityReport(){return{getReport:(e,t)=>(t.value=this.emulationData.activityReport,C.MR)}}getMalwareScanEventSubscription(){return{subscribe:({onStart:e,onStop:t,onProgressChanged:i,onScanStateChanged:s})=>(console.log("subscribe SUCCESS"),this.emulationData.malwareScanSubscirber={onStart:e,onStop:t,onProgressChanged:i,onScanStateChanged:s},C.MR),unsubscribe:()=>console.log("unsubscribe SUCCESS")}}getMalwareScan(){return{start:()=>{var e,t,i;return console.log("mlws start SUCCESS"),null===(e=this.emulationData.malwareScanSubscirber)||void 0===e||e.onStart(),this.emulationData.malwareScanStatistics={...K,lastScanTime:new Date},this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[0].state=g.aC,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[1].state=g.aC,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[2].state=g.aC,null===(t=this.emulationData.malwareScanSubscirber)||void 0===t||t.onProgressChanged(n.OL),null===(i=this.emulationData.malwareScanSubscirber)||void 0===i||i.onScanStateChanged(this.emulationData.malwareScanStatistics),setTimeout((()=>{this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[0].state=g.UO,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[1].state=g.aC,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[2].state=g.aC}),1400),setTimeout((()=>{this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[0].state=g.UO,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[1].state=g.UO,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[2].state=g.aC}),2800),setTimeout((()=>{this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[0].state=g.UO,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[1].state=g.UO,this.emulationData.malwareScanStatistics.statistic.statisticsByFolder[2].state=g.UO}),3900),this.emulationData.malwareScanStatistics.statistic.scannedFiles=n.Ds,this.emulationData.malwareScanProgressIntervalId=setInterval((()=>{var e,t;this.emulationData.malwareScanStatistics.statistic.scannedFiles+=Math.floor(this.emulationData.malwareScanStatistics.statistic.totalFiles/10),null===(e=this.emulationData.malwareScanSubscirber)||void 0===e||e.onProgressChanged(Math.ceil(this.emulationData.malwareScanStatistics.statistic.scannedFiles*n.KR/this.emulationData.malwareScanStatistics.statistic.totalFiles)),null===(t=this.emulationData.malwareScanSubscirber)||void 0===t||t.onScanStateChanged(this.emulationData.malwareScanStatistics)}),500),this.emulationData.malwareScanStopTimeoutId=setTimeout((()=>{var e;null===(e=this.emulationData.malwareScanSubscirber)||void 0===e||e.onStop(b.Gc),clearInterval(this.emulationData.malwareScanProgressIntervalId)}),5e3),C.MR},stop:()=>{var e;return console.log("mlws stop SUCCESS"),clearInterval(this.emulationData.malwareScanProgressIntervalId),clearTimeout(this.emulationData.malwareScanStopTimeoutId),this.emulationData.malwareScanStatistics={...this.emulationData.malwareScanStatistics,status:b.wF},null===(e=this.emulationData.malwareScanSubscirber)||void 0===e||e.onStop(b.Gc),C.MR},getLastState:e=>(e.value=this.emulationData.malwareScanStatistics||{...K,malwareList:[],statistic:{totalFiles:0,totalKsnFailedScanFiles:0,statisticsByFolder:[]}},b.rG)}}getThreatNotificationsSubscription(){return{subscribe:e=>(window.eAPI=window.eAPI||{},window.eAPI.triggerNewThreat=()=>{e.onThreatEvent({action:M.SL,objectName:"path/to/new/threat",threatName:"New.Threat.Name",threatType:p.EK,eventType:0}),e.onRemoteThreatEvent({action:M.SL,remoteIpAddress:"111.12.1.13",threatName:"Scary.remote.machine",eventType:0})},0),unsubscribe:()=>0}}getDownloadScan(){return{run:()=>console.log("Downloads Scan was started"),getInfo:e=>(e.value={result:C.MR,dateTime:new Date,resolved:!0,exist:!1,isDirectory:!1},C.MR)}}getKsnFileReputationRequestSubscription(){return{subscribe:e=>(setTimeout((()=>e.onDownloadScanStatusChanged(C.MR,this.emulationData.dangerousFile)),n.N5),C.MR)}}getMailController(){return{sendMail:(e,t)=>(setTimeout((()=>{t.onCompleted(C.MR,250)}),n.N5),C.MR),sendTestMail:(e,t)=>(setTimeout((()=>{t.onCompleted(C.MR,250)}),n.N5),C.MR)}}getKsnInfoDirectProvider(){return{asyncGetDirect:e=>(setTimeout((()=>{e.setLastResultCode(0),e.handleCloudInfo({})}),2e3),0)}}getKsnInfoProvider(){return{asyncGet:e=>(setTimeout((()=>{e.handleCloudInfo({m_whiteApplications:Math.ceil(1e4*Math.random()),m_malwareApplications:Math.ceil(1e4*Math.random()),m_totalFiles:Math.ceil(1e4*Math.random())})}),2e3),0)}}getUpdateController(){return{getProductHotfix:e=>(e.value="z",0)}}getProductStorage(){return{getValue:(e,t)=>{const i=JSON.parse(sessionStorage.getItem("storageValues"))||{};return t.value=null==i?void 0:i[e],C.MR},setValue:(e,t)=>{const i=JSON.parse(sessionStorage.getItem("storageValues"))||{};return i[e]=t,sessionStorage.setItem("storageValues",JSON.stringify(i)),C.MR},delete:e=>{const t=JSON.parse(sessionStorage.getItem("storageValues"))||{};return delete t[e],sessionStorage.setItem("storageValues",JSON.stringify(t)),C.MR}}}getDumpHelper(){return{writeFullDump:()=>0}}getDebugConfiguration(){return{isDebug:e=>(e.value=!0,0)}}getNetworkConnectionEventsSubscription(){return{subscribe:e=>(setTimeout((()=>{e.connectionChanged({connectionStatus:1})}),3e3),0),unsubscribe:()=>0}}getForbiddenAddresses(){return{removeForbiddenAddress:e=>(this.emulationData.forbiddenAddresses=(0,h.d1t)((0,h.fS0)(e),this.emulationData.forbiddenAddresses),0),getAddressList:e=>(e.value={allowed:this.emulationData.allowedAddresses,blocked:this.emulationData.forbiddenAddresses},0),addAllowedAddress:e=>(this.emulationData.forbiddenAddresses=this.emulationData.forbiddenAddresses.filter((t=>t.address!==e)),this.emulationData.allowedAddresses.push(e),0),removeAllowedAddress:e=>(this.emulationData.allowedAddresses=(0,h.d1t)((0,h.fS0)(e),this.emulationData.allowedAddresses),0)}}getNewsProvider(){return{getNews:e=>(e.value={items:this.emulationData.ipmNews},C.MR)}}getIpmGuiProvider(){return{getCurrentGui:e=>(e.value=this.emulationData.guiIpmInfo,0)}}getIpmGuiNotificationSubscription(){return{subscribe:e=>(setTimeout((()=>{e.onGuiReceived(C.MR)}),1e3),0)}}getNewsReceiptNotificationSubscription(){return{subscribe:e=>(setTimeout((()=>{this.emulationData.ipmNews=[...this.emulationData.freshIpmNews],e.onNewsChanged()}),4e3),0)}}getProtectionSettingsProvider(){return{getProtectionStatus:e=>(this.emulationData.stateRequestsCount||(this.emulationData.stateRequestsCount=0),this.emulationData.stateRequestsCount++,this.emulationData.stateRequestsCount<2?e.value=2:e.value=1,0),getBlockConnectionTimeout:e=>(e.value=this.emulationData.timeoutInMsec,0),setBlockConnectionTimeout:e=>(this.emulationData.timeoutInMsec=e,0),getAdwareRiskwarePornwareBlockStatus:e=>(e.value=this.emulationData.adwareRiskwarePornwareStatus,0),setAdwareRiskwarePornwareBlockStatus:e=>(this.emulationData.adwareRiskwarePornwareStatus=e,0),getExploitPreventionStatus:e=>(e.value=this.emulationData.exploitPreventionStatus,0),setExploitPreventionStatus:e=>(this.emulationData.exploitPreventionStatus=e,0),getSystemProcessesMemoryProtectionStatus:e=>(e.value=this.emulationData.systemProcessesMemoryProtectionStatus,0),setSystemProcessesMemoryProtectionStatus:e=>(this.emulationData.systemProcessesMemoryProtectionStatus=e,0)}}getUserModeSettingsProvider(){return{getMailSettings:e=>(e.value=this.emulationData.mailSettings,C.MR),setMailSettings:e=>(this.emulationData.mailSettings=e,C.MR),getUserMode:e=>(e.value=this.emulationData.mode,C.MR),setUserMode:e=>(this.emulationData.mode=e,C.MR),getThreatsReportSettings:(e,t)=>(e.value=this.emulationData.sender,t.value=this.emulationData.schedule,C.MR),setThreatsReportSettings:(e,t)=>(this.emulationData.sender=e,this.emulationData.schedule=t,C.MR)}}getThreatReportSenderProvider(){return{getSettings:e=>(e.value={reportOnDetectEnabled:this.emulationData.reportOnDetectEnabled},C.MR),setSettings:e=>(this.emulationData.reportOnDetectEnabled=e.reportOnDetectEnabled,C.MR)}}getPasswordManager(){return{isPasswordSet:e=>(e.value=this.emulationData.passwordProtectionState,0),setPassword:e=>this.emulationData.passwordProtectionState?-2147417851:(this.emulationData.password=e,this.emulationData.passwordProtectionState=!0,0),verifyPassword:e=>e===this.emulationData.password?0:-2147417851,changePassword:(e,t)=>e!==this.emulationData.password?-2147417851:""===t?(this.emulationData.password=t,this.emulationData.passwordProtectionState=!1,0):(this.emulationData.password=t,this.emulationData.passwordProtectionState=!0,0)}}getAgreementsManager(){return{getAgreements:e=>(this.emulationData.agreements.forEach((t=>e.push(t))),0),getAuxiliaryAgreements:e=>(this.emulationData.auxiliaryAgreements.forEach((t=>e.push(t))),0),getAllAcceptanceFacts:e=>(this.emulationData.agreementsAcceptance.forEach((t=>e.push(t))),0),registerAcceptanceFact:e=>{if(this.emulationData.agreementsAcceptance=this.emulationData.agreementsAcceptance.map((t=>t.agreementId===e.agreementId?{...t,accepted:!0,factModiticationDate:e.factModiticationDate}:t)),this.emulationData.agreementsAcceptance.every((e=>e.accepted)))for(let e in this.emulationData.featureAllowances)this.emulationData.featureAllowances[e]=n.Ds;return C.MR},registerAcceptanceFacts:function(e){e.forEach((e=>this.registerAcceptanceFact(e)))}}}getPermissionsChecker(){return{isFeatureAllowed:e=>this.emulationData.featureAllowances[e]}}getFeatureManager(){return{isFeatureEnabled:e=>this.emulationData.featureFlags[e],getFeatureFlagValue:(e,t)=>(e===v.Wx?t.value="C19B2298-455F-4A19-8189-6B7FA8692EB5:[40, 30, 10, 20]":t.value=n.ZD,C.MR)}}getKsnTransport(){return{sendFeedback:e=>(console.log(`Feedback was received successfully! Feedback body: ${JSON.stringify(e)}`),0),sendFeatureUsageStatistics:e=>(console.log(`GUI statistics was received successfully! Statistics body: ${JSON.stringify(e)}`),0)}}getProductInfoProvider(){return{getInfo:e=>(e.value={isDebugMode:this.emulationData.isDebugMode,isSpectronEnabled:this.emulationData.isSpectronEnabled,ppcsId:this.emulationData.ppcsId,edition:this.emulationData.edition,productLocalization:this.emulationData.productLocalization,appId:this.emulationData.appId},0)}}getGuiResourcesController(){return{refreshResourcesSymlink:()=>console.log("Symlink was refreshed")}}getMemoryCryptor(){return{encryptString:(e,t)=>(t.push(e),C.MR),decryptString:(e,t)=>(t.value=e[n.Ds],C.MR)}}getWindowsInteraction(){return{getCurrentDirectory:()=>(console.log("getCurrentDirectory was called from emulator"),n.ZD),getMd5OfFile:(e,t)=>t.value="emulated-md5",getCrc32OfSystemUserId:e=>(e.value="1234567",C.MR),createGuid:e=>(e.value=Math.ceil(Math.random()*n.KR).toString().repeat(5),C.MR),getKeyboard:(e,t)=>t.value=w.yy,getSessionId:()=>Math.ceil(Math.random()*n.KR).toString().repeat(5),getRegistrationFormType:(e,t)=>(t.value=f.eu,C.MR),getRegion:e=>(e.value=this.emulationData.userRegion,C.MR),checkAdminPrivileges:e=>(setTimeout((()=>e.onAdminPrivilegesCheckDone(!0)),n.N5),C.MR)}}getDiscoveryEventSubscription(){return{subscribe:e=>setTimeout((()=>{e.segmentChanged2({newSegmentInfo:{needToNotifyUser:!0},oldSegmentInfo:{}})}),3e3)}}getRegistrationController(){return{register:(e,t)=>(t.value=btoa(e),this.emulationData.ppcsId=t.value.split("").map((e=>e.charCodeAt(0))).join(""),this.emulationData.environmentVars[S.Ge]=this.emulationData.ppcsId,this.emulationData.registrationCode=t.value,this.getProductStorage().setValue("ppcsId",this.emulationData.ppcsId),C.MR),applyRegistrationCode:e=>this.emulationData.ppcsId===e?C.MR:C.xo,getOpenMarketoFormSchedule:e=>(e.value=n.xV,C.MR),getRegistrationCode:e=>(e.value=this.emulationData.registrationCode,C.MR)}}getProductIconClickNotifier(){return{subscribe:e=>e.onIconClick()}}getProductFullScreenChangeNotifier(){return{subscribe:e=>e.onFullScreenChange(n.Ds),getState:e=>(e.value=R.w.WINDOW,C.MR)}}getDumpSender(){return{sendProductReport:e=>(console.log(`Emulator of sendProductReport: issueText = ${e}`),C.MR),declineProductReport:()=>(console.log("Emulator of declineProductReport"),C.MR)}}getDumpReportNotificationSubscription(){return{subscribe:e=>(setTimeout((()=>e.onDumpReportChanged(this.emulationData.dumpReports)),3e3),setTimeout((()=>e.onEtlReportChanged(this.emulationData.dumpReports)),3e3),C.MR)}}getResponseSender(){return{send:(e,t,i)=>(console.log("getResponseSender","id",e,"result",t,"message",i),C.MR)}}getAdditionalInfoStorage(){return{setAdditionalInfoEvent:(e,t,i)=>(console.log("setAdditionalInfoEvent","sid",e,"type",t,"event",i),C.MR),getExperimentUsage:(e,t)=>(console.log("getExperimentUsage","sid",e,"event",t),t.value=(0,r.safeJsonStringify)({}),C.MR),getLastRegistrationEvent:(e,t)=>(console.log("getLastRegistrationEvent","sid",e,"event",t),C.MR)}}getTrustedTimeProvider(){return{getCurrentTrustedDateTime:e=>(e.value=Date.now(),C.MR)}}getKesTrialEventsProvider(){return{addEvent:(e,t)=>(console.log("kesTrialEventsProvider.addEvent: ",{eventName:e,data:t}),C.MR)}}getInstallNotificationSubscription(){return{subscribe:e=>(console.log("getInstallNotificationSubscription: subscribe was called",e),setTimeout((()=>e.OnInstallationStarted()),1e3),setTimeout((()=>e.OnInstallationFinished()),3e3),C.MR)}}getProxySettingsController(){return{setProxySettings:e=>(this.emulationData.proxySettings=e,C.MR),getProxySettings:e=>(e.value=this.emulationData.proxySettings,C.MR)}}getKesMigrationManager(){return E}}const $=H,Z=e=>{var t;const i=e.includes("\\")?e.split("\\"):e.split("/"),s=i[i.length-n.OL];return null===(t=window.kartMockData)||void 0===t?void 0:t.mockFilesContent[s]},q=()=>!1,j=(e,t,i)=>{console.log(`File with name=${e} data=${t} encoding=${i} was created`)},J={fs:s};var Y;!navigator.userAgent.includes("Cypress")&&navigator.userAgent.includes("Electron")||(window.require=(Y=d,e=>{if("electron"===e)return Y}),window.bl=new a.BL(d,$,J,n.OL),window.mainWindow=new d.BrowserWindow,window.location.pathname.includes("balloons")&&(window.balloon=new d.BrowserWindow,window.emulateBalloonData=({name:e,path:t,address:i,smtpCode:s,dumpReportFolder:a,...n})=>{const c={detail:{...n,path:t||"C:\\Some\\Awesome\\Destination\\Folder",name:e||"PDM:trojan.Win32.Bazon.a.Bazon.b.Bazon.c.Bazon.d.Bazon.e.Bazon.f.Bazon.g.Bazon.d.Bazon.e.Bazon.f.Bazon.ggg",address:i||"111.222.111.222",smtpCode:s||450,dumpReportFolder:a||"C:\\Some\\Awesome\\Destination\\Folder",agreementsAcceptanceFacts:(0,r.safeParseJson)('[{"agreementId":"PrivacyPolicy","factModiticationDate":"2022-12-23T11:08:38.635Z","accepted":false,"version":"product/legal/common/pp/1.0/en/privacy_policy.txt"},{"agreementId":"Supplemental","factModiticationDate":"2022-12-23T11:08:38.637Z","accepted":false,"version":"product/legal/EULA/Common_EULA_1.6/Corporate/GDPR/Kaspersky_AntiRansom/3.1/Supplemental/en/supplemental_8.txt"}]'),notAcceptedAgreementsText:{PrivacyPolicy:"PrivacyPolicy",Supplemental:"Supplemental"}}},l=new CustomEvent(o.cv,c);window.dispatchEvent(l)}))}}]);